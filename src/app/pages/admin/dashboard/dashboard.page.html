<!-- Admin Dashboard Layout -->
<div class="admin-dashboard h-screen flex bg-gray-50">
  <!-- Sidebar Navigation -->
  <div class="sidebar w-64 bg-white shadow-lg flex flex-col">
    <!-- Logo/Header -->
    <div class="p-6 border-b border-gray-200">
      <div class="flex items-center">
        <div class="bg-red-100 rounded-lg p-2 mr-3">
          <ion-icon
            name="shield-checkmark"
            class="text-xl text-red-600"
          ></ion-icon>
        </div>
        <div>
          <h2 class="text-lg font-bold text-gray-800">Admin Panel</h2>
          <p class="text-xs text-gray-500" *ngIf="userProfile">
            {{ userProfile.fullName }}
          </p>
        </div>
      </div>
    </div>

    <!-- Navigation Menu -->
    <nav class="flex-1 px-4 py-6 space-y-2">
      <button
        (click)="setActiveSection('dashboard')"
        [class]="'nav-item w-full text-left p-3 rounded-lg transition-colors flex items-center ' + (activeSection === 'dashboard' ? 'bg-red-50 text-red-600 border-l-4 border-red-600' : 'text-gray-600 hover:bg-gray-50')"
      >
        <ion-icon name="analytics" class="mr-3"></ion-icon>
        Dashboard
      </button>

      <button
        (click)="setActiveSection('workers')"
        [class]="'nav-item w-full text-left p-3 rounded-lg transition-colors flex items-center ' + (activeSection === 'workers' ? 'bg-red-50 text-red-600 border-l-4 border-red-600' : 'text-gray-600 hover:bg-gray-50')"
      >
        <ion-icon name="hammer" class="mr-3"></ion-icon>
        Worker Management
      </button>

      <button
        (click)="setActiveSection('clients')"
        [class]="'nav-item w-full text-left p-3 rounded-lg transition-colors flex items-center ' + (activeSection === 'clients' ? 'bg-red-50 text-red-600 border-l-4 border-red-600' : 'text-gray-600 hover:bg-gray-50')"
      >
        <ion-icon name="people" class="mr-3"></ion-icon>
        Client Management
      </button>

      <button
        (click)="setActiveSection('client-verifications')"
        [class]="'nav-item w-full text-left p-3 rounded-lg transition-colors flex items-center ' + (activeSection === 'client-verifications' ? 'bg-red-50 text-red-600 border-l-4 border-red-600' : 'text-gray-600 hover:bg-gray-50')"
      >
        <ion-icon name="shield-checkmark" class="mr-3"></ion-icon>
        <div class="flex-1">
          Client Verifications
          <div
            *ngIf="pendingVerifications.length > 0"
            class="inline-flex items-center justify-center w-5 h-5 ml-2 text-xs font-bold text-white bg-red-500 rounded-full"
          >
            {{ pendingVerifications.length }}
          </div>
        </div>
      </button>

      <button
        (click)="setActiveSection('bookings')"
        [class]="'nav-item w-full text-left p-3 rounded-lg transition-colors flex items-center ' + (activeSection === 'bookings' ? 'bg-red-50 text-red-600 border-l-4 border-red-600' : 'text-gray-600 hover:bg-gray-50')"
      >
        <ion-icon name="calendar" class="mr-3"></ion-icon>
        Booking Management
      </button>

      <button
        (click)="setActiveSection('reports')"
        [class]="'nav-item w-full text-left p-3 rounded-lg transition-colors flex items-center ' + (activeSection === 'reports' ? 'bg-red-50 text-red-600 border-l-4 border-red-600' : 'text-gray-600 hover:bg-gray-50')"
      >
        <ion-icon name="warning" class="mr-3"></ion-icon>
        Reports & Disputes
      </button>

      <button
        (click)="setActiveSection('services')"
        [class]="'nav-item w-full text-left p-3 rounded-lg transition-colors flex items-center ' + (activeSection === 'services' ? 'bg-red-50 text-red-600 border-l-4 border-red-600' : 'text-gray-600 hover:bg-gray-50')"
      >
        <ion-icon name="construct" class="mr-3"></ion-icon>
        Services Management
      </button>
    </nav>

    <!-- Logout Button -->
    <div class="p-4 border-t border-gray-200">
      <button
        (click)="logout()"
        class="w-full p-3 text-red-600 hover:bg-red-50 rounded-lg transition-colors flex items-center justify-center"
      >
        <ion-icon name="log-out-outline" class="mr-2"></ion-icon>
        Logout
      </button>
    </div>
  </div>

  <!-- Main Content Area -->
  <div class="main-content flex-1 flex flex-col">
    <!-- Top Header -->
    <header class="bg-white border-b border-gray-200 px-6 py-4">
      <div class="flex items-center justify-between">
        <h1 class="text-2xl font-bold text-gray-800">
          {{ getSectionTitle() }}
        </h1>
        <div class="flex items-center space-x-4">
          <div class="text-sm text-gray-500">{{ getCurrentDate() }}</div>
        </div>
      </div>
    </header>

    <!-- Content Area -->
    <main class="flex-1 overflow-y-auto p-6">
      <!-- Dashboard Overview -->
      <div *ngIf="activeSection === 'dashboard'">
        <!-- Analytics Cards -->
        <div class="mb-8">
          <div class="flex items-center justify-between mb-6">
            <div>
              <h2 class="text-xl font-semibold text-gray-800">
                Analytics Overview
              </h2>
              <p class="text-gray-500 text-sm" *ngIf="lastAnalyticsUpdate">
                Last updated: {{ lastAnalyticsUpdate | date:'short' }}
              </p>
            </div>
            <button
              (click)="refreshAnalytics()"
              [disabled]="isRefreshingAnalytics"
              class="flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <ion-icon
                [name]="isRefreshingAnalytics ? 'sync' : 'refresh'"
                [class]="isRefreshingAnalytics ? 'animate-spin' : ''"
              ></ion-icon>
              <span
                >{{ isRefreshingAnalytics ? 'Refreshing...' : 'Refresh' }}</span
              >
            </button>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Total Clients Card -->
            <div
              class="rounded-xl shadow-lg p-6 text-center bg-gradient-to-br from-blue-500 to-blue-600 text-white"
            >
              <div class="flex items-center justify-center mb-4">
                <ion-icon name="people" class="text-4xl"></ion-icon>
              </div>
              <h3 class="text-3xl font-bold mb-2">
                {{ analytics.totalClients || 0 }}
              </h3>
              <p class="text-blue-100">Total Clients</p>
            </div>

            <!-- Total Workers Card -->
            <div
              class="rounded-xl shadow-lg p-6 text-center bg-gradient-to-br from-green-500 to-green-600 text-white"
            >
              <div class="flex items-center justify-center mb-4">
                <ion-icon name="hammer" class="text-4xl"></ion-icon>
              </div>
              <h3 class="text-3xl font-bold mb-2">
                {{ analytics.totalWorkers || 0 }}
              </h3>
              <p class="text-green-100">Total Workers</p>
            </div>

            <!-- Pending Verifications Card -->
            <div
              class="rounded-xl shadow-lg p-6 text-center bg-gradient-to-br from-yellow-500 to-orange-500 text-white"
            >
              <div class="flex items-center justify-center mb-4">
                <ion-icon name="hourglass" class="text-4xl"></ion-icon>
              </div>
              <h3 class="text-3xl font-bold mb-2">
                <span *ngIf="!isRefreshingAnalytics"
                  >{{ analytics.pendingVerifications || 0 }}</span
                >
                <ion-spinner
                  *ngIf="isRefreshingAnalytics"
                  name="crescent"
                  class="w-8 h-8"
                ></ion-spinner>
              </h3>
              <p class="text-yellow-100">Pending Verifications</p>
            </div>

            <!-- Active Bookings Card -->
            <div
              class="rounded-xl shadow-lg p-6 text-center bg-gradient-to-br from-purple-500 to-purple-600 text-white"
            >
              <div class="flex items-center justify-center mb-4">
                <ion-icon name="calendar" class="text-4xl"></ion-icon>
              </div>
              <h3 class="text-3xl font-bold mb-2">
                {{ analytics.activeBookings || 0 }}
              </h3>
              <p class="text-purple-100">Active Bookings</p>
            </div>

            <!-- Completed Bookings Card -->
            <div
              class="rounded-xl shadow-lg p-6 text-center bg-gradient-to-br from-teal-500 to-teal-600 text-white"
            >
              <div class="flex items-center justify-center mb-4">
                <ion-icon name="checkmark-circle" class="text-4xl"></ion-icon>
              </div>
              <h3 class="text-3xl font-bold mb-2">
                <span *ngIf="!isRefreshingAnalytics"
                  >{{ analytics.completedBookings || 0 }}</span
                >
                <ion-spinner
                  *ngIf="isRefreshingAnalytics"
                  name="crescent"
                  class="w-8 h-8"
                ></ion-spinner>
              </h3>
              <p class="text-teal-100">Completed Bookings</p>
            </div>

            <!-- Revenue Card -->
            <div
              class="rounded-xl shadow-lg p-6 text-center bg-gradient-to-br from-red-500 to-pink-500 text-white"
            >
              <div class="flex items-center justify-center mb-4">
                <ion-icon name="cash" class="text-4xl"></ion-icon>
              </div>
              <h3 class="text-3xl font-bold mb-2">
                â‚±{{ analytics.totalRevenue || 0 | number:'1.2-2' }}
              </h3>
              <p class="text-red-100">Total Revenue</p>
            </div>
          </div>
        </div>

        <!-- System Status -->
        <div class="bg-white rounded-xl shadow-lg p-6">
          <h3 class="text-xl font-semibold text-gray-800 mb-4">
            System Status
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div
              class="flex items-center justify-between p-4 bg-gray-50 rounded-lg"
            >
              <span class="text-gray-600">Database</span>
              <div class="flex items-center">
                <div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div>
                <span class="text-green-600 text-sm font-medium">Online</span>
              </div>
            </div>
            <div
              class="flex items-center justify-between p-4 bg-gray-50 rounded-lg"
            >
              <span class="text-gray-600">Firebase Auth</span>
              <div class="flex items-center">
                <div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div>
                <span class="text-green-600 text-sm font-medium">Active</span>
              </div>
            </div>
            <div
              class="flex items-center justify-between p-4 bg-gray-50 rounded-lg"
            >
              <span class="text-gray-600">Notifications</span>
              <div class="flex items-center">
                <div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div>
                <span class="text-green-600 text-sm font-medium">Enabled</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Worker Management Section -->
      <div *ngIf="activeSection === 'workers'">
        <!-- Section Tabs -->
        <div class="mb-6">
          <div class="border-b border-gray-200">
            <nav class="-mb-px flex space-x-8">
              <button
                (click)="setWorkerTab('pending')"
                [class]="'py-4 px-1 border-b-2 font-medium text-sm transition-colors ' + (workerActiveTab === 'pending' ? 'border-red-500 text-red-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300')"
              >
                <div class="flex items-center">
                  <ion-icon name="hourglass" class="mr-2"></ion-icon>
                  Pending Verification ({{ pendingWorkers.length }})
                </div>
              </button>
              <button
                (click)="setWorkerTab('verified')"
                [class]="'py-4 px-1 border-b-2 font-medium text-sm transition-colors ' + (workerActiveTab === 'verified' ? 'border-red-500 text-red-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300')"
              >
                <div class="flex items-center">
                  <ion-icon name="checkmark-circle" class="mr-2"></ion-icon>
                  Verified Workers ({{ verifiedWorkers.length }})
                </div>
              </button>
            </nav>
          </div>
        </div>

        <!-- Pending Verification Queue -->
        <div *ngIf="workerActiveTab === 'pending'">
          <!-- Header and Search -->
          <div class="mb-6">
            <div class="flex items-center justify-between mb-4">
              <h2 class="text-xl font-semibold text-gray-800">
                Worker Verification Queue
              </h2>
              <button
                (click)="loadPendingWorkers()"
                class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors flex items-center"
              >
                <ion-icon name="refresh" class="mr-2"></ion-icon>
                Refresh
              </button>
            </div>

            <!-- Search Bar -->
            <div class="relative max-w-md">
              <ion-icon
                name="search"
                class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"
              ></ion-icon>
              <input
                type="text"
                [(ngModel)]="pendingWorkerSearchTerm"
                (ngModelChange)="filterPendingWorkers()"
                placeholder="Search by name or address..."
                class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"
              />
            </div>
          </div>

          <div *ngIf="isLoadingWorkers" class="text-center py-8">
            <ion-spinner color="primary"></ion-spinner>
            <p class="mt-2 text-gray-500">Loading workers...</p>
          </div>

          <div
            *ngIf="!isLoadingWorkers && filteredPendingWorkers.length === 0 && pendingWorkerSearchTerm"
            class="bg-white rounded-xl shadow-lg p-8 text-center"
          >
            <ion-icon
              name="search"
              class="text-6xl text-gray-300 mb-4"
            ></ion-icon>
            <h3 class="text-xl font-semibold text-gray-600 mb-2">
              No Results Found
            </h3>
            <p class="text-gray-500">
              No workers found matching "{{ pendingWorkerSearchTerm }}"
            </p>
          </div>

          <div
            *ngIf="!isLoadingWorkers && pendingWorkers.length === 0 && !pendingWorkerSearchTerm"
            class="bg-white rounded-xl shadow-lg p-8 text-center"
          >
            <ion-icon
              name="checkmark-circle"
              class="text-6xl text-green-500 mb-4"
            ></ion-icon>
            <h3 class="text-xl font-semibold text-gray-600 mb-2">
              All Caught Up!
            </h3>
            <p class="text-gray-500">
              No workers pending verification at the moment.
            </p>
          </div>

          <!-- Workers Table -->
          <div
            *ngIf="!isLoadingWorkers && filteredPendingWorkers.length > 0"
            class="bg-white rounded-xl shadow-lg overflow-hidden"
          >
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                  <tr>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Worker Name
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Address
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Skills
                    </th>
                    <th
                      class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Actions
                    </th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                  <tr
                    *ngFor="let worker of filteredPendingWorkers"
                    class="hover:bg-gray-50 transition-colors"
                  >
                    <td class="px-6 py-4 whitespace-nowrap">
                      <div class="flex items-center">
                        <div class="flex-shrink-0 h-10 w-10">
                          <div
                            class="h-10 w-10 rounded-full bg-red-100 flex items-center justify-center"
                          >
                            <span class="text-sm font-medium text-red-600">
                              {{ getInitials(worker.fullName) }}
                            </span>
                          </div>
                        </div>
                        <div class="ml-4">
                          <div class="text-sm font-medium text-gray-900">
                            {{ worker.fullName }}
                          </div>
                          <div class="text-sm text-gray-500">
                            {{ worker.email }}
                          </div>
                        </div>
                      </div>
                    </td>
                    <td class="px-6 py-4">
                      <div class="text-sm text-gray-900">
                        {{ worker.fullAddress || 'Not provided' }}
                      </div>
                      <div class="text-sm text-gray-500">
                        {{ worker.phone }}
                      </div>
                    </td>
                    <td class="px-6 py-4">
                      <div class="flex flex-wrap gap-1">
                        <span
                          *ngFor="let skill of getFirstFewSkills(worker.skills)"
                          class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"
                        >
                          {{ skill }}
                        </span>
                        <span
                          *ngIf="worker.skills && worker.skills.length > 3"
                          class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-600"
                        >
                          +{{ worker.skills.length - 3 }} more
                        </span>
                      </div>
                    </td>
                    <td
                      class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium"
                    >
                      <div class="flex items-center justify-center space-x-2">
                        <button
                          (click)="viewWorkerDetails(worker)"
                          class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-xs transition-colors flex items-center"
                        >
                          <ion-icon name="eye" class="text-sm mr-1"></ion-icon>
                          View
                        </button>
                        <button
                          (click)="approveWorker(worker)"
                          [disabled]="processingWorker === worker.uid"
                          class="bg-green-500 hover:bg-green-600 disabled:bg-gray-400 text-white px-3 py-1 rounded text-xs transition-colors flex items-center"
                        >
                          <ion-icon
                            name="checkmark"
                            class="text-sm mr-1"
                          ></ion-icon>
                          Approve
                        </button>
                        <button
                          (click)="rejectWorker(worker)"
                          [disabled]="processingWorker === worker.uid"
                          class="bg-red-500 hover:bg-red-600 disabled:bg-gray-400 text-white px-3 py-1 rounded text-xs transition-colors flex items-center"
                        >
                          <ion-icon
                            name="close"
                            class="text-sm mr-1"
                          ></ion-icon>
                          Reject
                        </button>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Verified Workers -->
        <div *ngIf="workerActiveTab === 'verified'">
          <!-- Search Bar -->
          <div class="mb-6">
            <div class="relative max-w-md">
              <ion-icon
                name="search"
                class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"
              ></ion-icon>
              <input
                type="text"
                [(ngModel)]="workerSearchTerm"
                (ngModelChange)="filterVerifiedWorkers()"
                placeholder="Search by name or skill..."
                class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"
              />
            </div>
          </div>

          <div *ngIf="isLoadingWorkers" class="text-center py-8">
            <ion-spinner color="primary"></ion-spinner>
            <p class="mt-2 text-gray-500">Loading workers...</p>
          </div>

          <div
            *ngIf="!isLoadingWorkers && filteredVerifiedWorkers.length === 0"
            class="bg-white rounded-xl shadow-lg p-8 text-center"
          >
            <ion-icon
              name="people-outline"
              class="text-6xl text-gray-300 mb-4"
            ></ion-icon>
            <h3 class="text-xl font-semibold text-gray-600 mb-2">
              No Verified Workers
            </h3>
            <p class="text-gray-500">
              No verified workers found matching your search.
            </p>
          </div>

          <!-- Verified Workers Table -->
          <div
            *ngIf="!isLoadingWorkers && filteredVerifiedWorkers.length > 0"
            class="bg-white rounded-xl shadow-lg overflow-hidden"
          >
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                  <tr>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Worker Name
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Address
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Skills
                    </th>
                    <th
                      class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Status
                    </th>
                    <th
                      class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Actions
                    </th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                  <tr
                    *ngFor="let worker of filteredVerifiedWorkers"
                    class="hover:bg-gray-50 transition-colors"
                  >
                    <td class="px-6 py-4 whitespace-nowrap">
                      <div class="flex items-center">
                        <div class="flex-shrink-0 h-10 w-10">
                          <div
                            class="h-10 w-10 rounded-full bg-green-100 flex items-center justify-center"
                          >
                            <span class="text-sm font-medium text-green-600">
                              {{ getInitials(worker.fullName) }}
                            </span>
                          </div>
                        </div>
                        <div class="ml-4">
                          <div class="text-sm font-medium text-gray-900">
                            {{ worker.fullName }}
                          </div>
                          <div class="text-sm text-gray-500">
                            {{ worker.email }}
                          </div>
                        </div>
                      </div>
                    </td>
                    <td class="px-6 py-4">
                      <div class="text-sm text-gray-900">
                        {{ worker.fullAddress || 'Not provided' }}
                      </div>
                      <div class="text-sm text-gray-500">
                        {{ worker.phone }}
                      </div>
                    </td>
                    <td class="px-6 py-4">
                      <div class="flex flex-wrap gap-1">
                        <span
                          *ngFor="let skill of getFirstFewSkills(worker.skills)"
                          class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"
                        >
                          {{ skill }}
                        </span>
                        <span
                          *ngIf="worker.skills && worker.skills.length > 3"
                          class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-600"
                        >
                          +{{ worker.skills.length - 3 }} more
                        </span>
                      </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-center">
                      <span
                        class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"
                      >
                        <ion-icon
                          name="checkmark-circle"
                          class="mr-1"
                        ></ion-icon>
                        Verified
                      </span>
                    </td>
                    <td
                      class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium"
                    >
                      <div class="flex items-center justify-center space-x-2">
                        <button
                          (click)="viewWorkerDetails(worker)"
                          class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-xs transition-colors flex items-center"
                        >
                          <ion-icon name="eye" class="text-sm mr-1"></ion-icon>
                          View
                        </button>
                        <button
                          (click)="suspendWorker(worker)"
                          [disabled]="processingWorker === worker.uid"
                          class="bg-yellow-500 hover:bg-yellow-600 disabled:bg-gray-400 text-white px-3 py-1 rounded text-xs transition-colors flex items-center"
                        >
                          <ion-icon
                            name="pause"
                            class="text-sm mr-1"
                          ></ion-icon>
                          Suspend
                        </button>
                        <button
                          (click)="banWorker(worker)"
                          [disabled]="processingWorker === worker.uid"
                          class="bg-gray-700 hover:bg-gray-800 disabled:bg-gray-400 text-white px-3 py-1 rounded text-xs transition-colors flex items-center"
                        >
                          <ion-icon name="ban" class="text-sm mr-1"></ion-icon>
                          Ban
                        </button>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Client Verifications Section -->
      <div
        *ngIf="activeSection === 'client-verifications'"
        class="animate-fadeIn"
      >
        <!-- Enhanced Header -->
        <div
          class="relative bg-gradient-to-br from-purple-50 via-purple-100 to-indigo-50 rounded-2xl p-8 mb-8 overflow-hidden"
        >
          <!-- Background Pattern -->
          <div class="absolute inset-0 opacity-5">
            <div
              class="absolute top-4 left-4 w-32 h-32 bg-purple-500 rounded-full blur-3xl"
            ></div>
            <div
              class="absolute bottom-4 right-4 w-24 h-24 bg-indigo-500 rounded-full blur-2xl"
            ></div>
          </div>

          <div class="relative z-10">
            <div class="flex items-center justify-between">
              <div class="flex items-center">
                <div
                  class="bg-gradient-to-br from-purple-500 to-purple-600 w-16 h-16 rounded-2xl flex items-center justify-center text-white mr-6 shadow-lg"
                >
                  <ion-icon name="shield-checkmark" class="text-3xl"></ion-icon>
                </div>
                <div>
                  <h1 class="text-3xl font-bold text-gray-800">
                    Client Verifications
                  </h1>
                  <p class="text-gray-600 text-lg">
                    Review and approve client verification documents
                  </p>
                </div>
              </div>
              <div class="flex items-center space-x-4">
                <div class="bg-white rounded-xl px-6 py-3 shadow-md">
                  <div class="text-2xl font-bold text-purple-600">
                    {{ pendingVerifications.length }}
                  </div>
                  <div class="text-sm text-gray-600">Pending</div>
                </div>
                <button
                  (click)="loadPendingVerifications()"
                  [disabled]="isLoadingVerifications"
                  class="bg-white text-purple-600 px-6 py-3 rounded-xl border border-purple-200 hover:bg-purple-50 transition-colors font-semibold shadow-md disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  <ion-icon
                    name="refresh"
                    class="mr-2"
                    [class.animate-spin]="isLoadingVerifications"
                  ></ion-icon>
                  Refresh
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Pending Verifications List -->
        <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
          <div class="px-6 py-4 border-b border-gray-200">
            <h2 class="text-xl font-bold text-gray-800">
              Pending Verification Requests
            </h2>
          </div>

          <!-- Loading State -->
          <div *ngIf="isLoadingVerifications" class="p-8 text-center">
            <div class="inline-flex items-center">
              <svg
                class="animate-spin -ml-1 mr-3 h-8 w-8 text-purple-500"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
              >
                <circle
                  class="opacity-25"
                  cx="12"
                  cy="12"
                  r="10"
                  stroke="currentColor"
                  stroke-width="4"
                ></circle>
                <path
                  class="opacity-75"
                  fill="currentColor"
                  d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                ></path>
              </svg>
              <span class="text-gray-600 text-lg"
                >Loading verifications...</span
              >
            </div>
          </div>

          <!-- No Pending Verifications -->
          <div
            *ngIf="!isLoadingVerifications && pendingVerifications.length === 0"
            class="p-8 text-center"
          >
            <ion-icon
              name="checkmark-circle"
              class="text-green-400 text-6xl mb-4"
            ></ion-icon>
            <h3 class="text-xl font-semibold text-gray-800 mb-2">
              All Caught Up!
            </h3>
            <p class="text-gray-600">
              No pending client verifications at the moment.
            </p>
          </div>

          <!-- Verifications List -->
          <div
            *ngIf="!isLoadingVerifications && pendingVerifications.length > 0"
            class="divide-y divide-gray-200"
          >
            <div
              *ngFor="let verification of pendingVerifications"
              class="p-6 hover:bg-gray-50 transition-colors cursor-pointer"
              (click)="viewVerificationDetails(verification)"
            >
              <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                  <div
                    class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center"
                  >
                    <ion-icon
                      name="person"
                      class="text-purple-600 text-xl"
                    ></ion-icon>
                  </div>
                  <div>
                    <h3 class="text-lg font-semibold text-gray-800">
                      {{ verification.userName }}
                    </h3>
                    <p class="text-gray-600">{{ verification.userEmail }}</p>
                    <div class="flex items-center text-sm text-gray-500 mt-1">
                      <ion-icon name="time" class="mr-1"></ion-icon>
                      Submitted {{ verification.submittedAt?.toDate() |
                      date:'medium' }}
                    </div>
                  </div>
                </div>
                <div class="flex items-center space-x-4">
                  <div class="text-right">
                    <div class="text-sm text-gray-500">ID Type</div>
                    <div class="font-semibold text-gray-800">
                      {{ verification.idType }}
                    </div>
                  </div>
                  <div
                    class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-sm font-semibold"
                  >
                    Pending Review
                  </div>
                  <ion-icon
                    name="chevron-forward"
                    class="text-gray-400"
                  ></ion-icon>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Verification Review Modal -->
      <div
        *ngIf="isVerificationModalOpen"
        class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4"
      >
        <div
          class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden"
        >
          <!-- Header -->
          <div
            class="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-6"
          >
            <h2 class="text-2xl font-bold mb-2">Client Verification Review</h2>
            <p class="text-purple-100">{{ selectedVerification?.userName }}</p>
          </div>

          <!-- Content -->
          <div class="p-6 overflow-y-auto max-h-[60vh]">
            <div *ngIf="selectedVerification" class="space-y-6">
              <!-- Client Information -->
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="space-y-4">
                  <h3 class="text-lg font-semibold text-gray-800 border-b pb-2">
                    Personal Information
                  </h3>
                  <div class="space-y-2">
                    <div class="flex justify-between">
                      <span class="text-gray-600">Full Name:</span>
                      <span class="font-semibold"
                        >{{ selectedVerification.userName }}</span
                      >
                    </div>
                    <div class="flex justify-between">
                      <span class="text-gray-600">Email:</span>
                      <span class="font-semibold"
                        >{{ selectedVerification.userEmail }}</span
                      >
                    </div>
                    <div class="flex justify-between">
                      <span class="text-gray-600">ID Type:</span>
                      <span class="font-semibold"
                        >{{ selectedVerification.idType }}</span
                      >
                    </div>
                    <div class="flex justify-between">
                      <span class="text-gray-600">ID Number:</span>
                      <span class="font-semibold"
                        >{{ selectedVerification.idNumber }}</span
                      >
                    </div>
                    <div class="flex justify-between">
                      <span class="text-gray-600">Birth Date:</span>
                      <span class="font-semibold"
                        >{{ selectedVerification.birthDate | date:'longDate'
                        }}</span
                      >
                    </div>
                  </div>
                </div>
                <div class="space-y-4">
                  <h3 class="text-lg font-semibold text-gray-800 border-b pb-2">
                    Address
                  </h3>
                  <p class="text-gray-700">
                    {{ selectedVerification.address }}
                  </p>
                  <div class="text-sm text-gray-500">
                    <div>
                      Submitted: {{ selectedVerification.submittedAt?.toDate() |
                      date:'medium' }}
                    </div>
                  </div>
                </div>
              </div>

              <!-- Document Images -->
              <div class="space-y-4">
                <h3 class="text-lg font-semibold text-gray-800 border-b pb-2">
                  Uploaded Documents
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <!-- ID Image -->
                  <div class="space-y-2">
                    <h4 class="font-semibold text-gray-700">Valid ID</h4>
                    <div class="border rounded-lg p-4 bg-gray-50">
                      <img
                        [src]="selectedVerification.idImageBase64"
                        alt="ID Document"
                        class="w-full h-64 object-contain rounded-lg bg-white"
                      />
                    </div>
                  </div>
                  <!-- Profile Image -->
                  <div class="space-y-2">
                    <h4 class="font-semibold text-gray-700">Profile Picture</h4>
                    <div
                      class="border rounded-lg p-4 bg-gray-50 flex justify-center"
                    >
                      <img
                        [src]="selectedVerification.profileImageBase64"
                        alt="Profile Picture"
                        class="w-48 h-64 object-cover rounded-lg bg-white"
                      />
                    </div>
                  </div>
                </div>
              </div>

              <!-- Review Notes -->
              <div class="space-y-2">
                <label
                  for="reviewNotes"
                  class="block text-sm font-semibold text-gray-700"
                  >Review Notes (Optional for approval, Required for
                  rejection)</label
                >
                <textarea
                  id="reviewNotes"
                  [(ngModel)]="reviewNotes"
                  placeholder="Add any notes about your decision..."
                  rows="3"
                  class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
                ></textarea>
              </div>
            </div>
          </div>

          <!-- Footer Actions -->
          <div
            class="bg-gray-50 px-6 py-4 flex flex-col sm:flex-row gap-3 justify-end"
          >
            <button
              (click)="closeVerificationModal()"
              class="w-full sm:w-auto px-6 py-3 border-2 border-gray-300 text-gray-700 font-semibold rounded-xl hover:bg-gray-100 transition-all duration-200"
            >
              Cancel
            </button>
            <button
              (click)="rejectVerification()"
              [disabled]="isProcessingVerification"
              class="w-full sm:w-auto px-6 py-3 bg-red-500 hover:bg-red-600 text-white font-semibold rounded-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <span
                *ngIf="!isProcessingVerification"
                class="flex items-center justify-center"
              >
                <ion-icon name="close-outline" class="mr-2"></ion-icon>
                Reject
              </span>
              <span *ngIf="isProcessingVerification">Processing...</span>
            </button>
            <button
              (click)="approveVerification()"
              [disabled]="isProcessingVerification"
              class="w-full sm:w-auto px-6 py-3 bg-green-500 hover:bg-green-600 text-white font-semibold rounded-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <span
                *ngIf="!isProcessingVerification"
                class="flex items-center justify-center"
              >
                <ion-icon name="checkmark-outline" class="mr-2"></ion-icon>
                Approve
              </span>
              <span *ngIf="isProcessingVerification">Processing...</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Reports & Disputes Section -->
      <div *ngIf="activeSection === 'reports'" class="animate-fadeIn">
        <!-- Enhanced Header -->
        <div
          class="relative bg-gradient-to-br from-red-50 via-red-100 to-orange-50 rounded-2xl p-8 mb-8 overflow-hidden"
        >
          <!-- Background Pattern -->
          <div class="absolute inset-0 opacity-5">
            <div
              class="absolute top-4 left-4 w-32 h-32 bg-red-500 rounded-full blur-3xl"
            ></div>
            <div
              class="absolute bottom-4 right-4 w-24 h-24 bg-orange-500 rounded-full blur-2xl"
            ></div>
          </div>

          <div class="relative z-10">
            <div class="flex items-center justify-between">
              <div class="flex items-center space-x-4">
                <div
                  class="w-16 h-16 bg-gradient-to-br from-red-500 to-orange-500 rounded-2xl flex items-center justify-center shadow-lg"
                >
                  <ion-icon name="flag" class="text-white text-2xl"></ion-icon>
                </div>
                <div>
                  <h2 class="text-3xl font-bold text-gray-800">
                    Reports & Disputes
                  </h2>
                  <p class="text-gray-600 mt-1">
                    Manage client reports and worker disputes
                  </p>
                </div>
              </div>
              <button
                (click)="refreshReports()"
                class="bg-white/80 hover:bg-white text-red-600 px-4 py-2 rounded-xl font-semibold transition-all duration-200 flex items-center space-x-2 shadow-lg"
              >
                <ion-icon name="refresh" class="text-lg"></ion-icon>
                <span>Refresh</span>
              </button>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8">
              <div
                class="bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-lg border border-white/20"
              >
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-sm font-medium text-gray-600">
                      Total Reports
                    </p>
                    <p class="text-3xl font-bold text-gray-800">
                      {{ reportViewType === 'worker' ? getReportsCount() :
                      getClientReportsCount() }}
                    </p>
                  </div>
                  <div
                    class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center"
                  >
                    <ion-icon
                      name="document-text"
                      class="text-blue-600 text-xl"
                    ></ion-icon>
                  </div>
                </div>
              </div>

              <div
                class="bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-lg border border-white/20"
              >
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-sm font-medium text-gray-600">
                      Pending Review
                    </p>
                    <p class="text-3xl font-bold text-yellow-600">
                      {{ reportViewType === 'worker' ? getPendingReportsCount()
                      : getPendingClientReportsCount() }}
                    </p>
                  </div>
                  <div
                    class="w-12 h-12 bg-yellow-100 rounded-xl flex items-center justify-center"
                  >
                    <ion-icon
                      name="time"
                      class="text-yellow-600 text-xl"
                    ></ion-icon>
                  </div>
                </div>
              </div>

              <div
                class="bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-lg border border-white/20"
              >
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-sm font-medium text-gray-600">
                      Critical Issues
                    </p>
                    <p class="text-3xl font-bold text-red-600">
                      {{ reportViewType === 'worker' ? getCriticalReportsCount()
                      : getCriticalClientReportsCount() }}
                    </p>
                  </div>
                  <div
                    class="w-12 h-12 bg-red-100 rounded-xl flex items-center justify-center"
                  >
                    <ion-icon
                      name="warning"
                      class="text-red-600 text-xl"
                    ></ion-icon>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Report Type Toggle -->
        <div class="bg-white rounded-2xl shadow-lg p-4 mb-6">
          <div class="flex items-center space-x-4">
            <button
              (click)="setReportViewType('worker')"
              [class]="'flex-1 px-4 py-3 rounded-xl font-semibold transition-all ' + (reportViewType === 'worker' ? 'bg-red-500 text-white shadow-lg' : 'bg-gray-100 text-gray-600 hover:bg-gray-200')"
            >
              <ion-icon name="person" class="mr-2"></ion-icon>
              Worker Reports
              <span class="ml-2 bg-white/20 px-2 py-1 rounded-full text-xs">
                {{ getReportsCount() }}
              </span>
            </button>
            <button
              (click)="setReportViewType('client')"
              [class]="'flex-1 px-4 py-3 rounded-xl font-semibold transition-all ' + (reportViewType === 'client' ? 'bg-red-500 text-white shadow-lg' : 'bg-gray-100 text-gray-600 hover:bg-gray-200')"
            >
              <ion-icon name="people" class="mr-2"></ion-icon>
              Client Reports
              <span class="ml-2 bg-white/20 px-2 py-1 rounded-full text-xs">
                {{ getClientReportsCount() }}
              </span>
            </button>
          </div>
        </div>

        <!-- Filters and Search (Worker Reports) -->
        <div *ngIf="reportViewType === 'worker'">
          <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
              <!-- Search -->
              <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  Search Reports
                </label>
                <div class="relative">
                  <ion-icon
                    name="search"
                    class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"
                  ></ion-icon>
                  <input
                    type="text"
                    [(ngModel)]="reportSearchTerm"
                    (input)="filterReports()"
                    placeholder="Search by client, worker, or description..."
                    class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-transparent"
                  />
                </div>
              </div>

              <!-- Status Filter -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  Status
                </label>
                <select
                  [(ngModel)]="reportStatusFilter"
                  (change)="filterReports()"
                  class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-transparent"
                >
                  <option value="all">All Status</option>
                  <option value="pending">Pending</option>
                  <option value="under_review">Under Review</option>
                  <option value="resolved">Resolved</option>
                  <option value="dismissed">Dismissed</option>
                </select>
              </div>

              <!-- Severity Filter -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  Severity
                </label>
                <select
                  [(ngModel)]="reportSeverityFilter"
                  (change)="filterReports()"
                  class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-transparent"
                >
                  <option value="all">All Severity</option>
                  <option value="low">Low</option>
                  <option value="medium">Medium</option>
                  <option value="high">High</option>
                  <option value="critical">Critical</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Reports Table -->
          <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                  <tr>
                    <th
                      class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Report Details
                    </th>
                    <th
                      class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Client
                    </th>
                    <th
                      class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Worker
                    </th>
                    <th
                      class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Severity
                    </th>
                    <th
                      class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Status
                    </th>
                    <th
                      class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Date
                    </th>
                    <th
                      class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Actions
                    </th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                  <tr
                    *ngFor="let report of filteredReports"
                    class="hover:bg-gray-50 transition-colors duration-200"
                  >
                    <td class="px-6 py-4">
                      <div class="flex items-start space-x-3">
                        <div class="flex-shrink-0">
                          <div
                            class="w-10 h-10 bg-gradient-to-br from-red-100 to-orange-100 rounded-lg flex items-center justify-center"
                          >
                            <ion-icon
                              name="flag"
                              class="text-red-600"
                            ></ion-icon>
                          </div>
                        </div>
                        <div class="flex-1 min-w-0">
                          <p class="text-sm font-medium text-gray-900 truncate">
                            {{ getReportTypeDisplayName(report.reportType) }}
                          </p>
                          <p class="text-sm text-gray-500 truncate">
                            {{ report.title }}
                          </p>
                          <p class="text-xs text-gray-400 mt-1 line-clamp-2">
                            {{ report.description }}
                          </p>
                        </div>
                      </div>
                    </td>
                    <td class="px-6 py-4">
                      <div class="flex items-center space-x-3">
                        <div
                          class="w-8 h-8 bg-gradient-to-br from-blue-100 to-blue-200 rounded-full flex items-center justify-center"
                        >
                          <span class="text-xs font-semibold text-blue-700">
                            {{ getInitials(report.reporterName) }}
                          </span>
                        </div>
                        <div>
                          <p class="text-sm font-medium text-gray-900">
                            {{ report.reporterName }}
                          </p>
                          <p class="text-xs text-gray-500">
                            {{ report.reporterEmail }}
                          </p>
                        </div>
                      </div>
                    </td>
                    <td class="px-6 py-4">
                      <div class="flex items-center space-x-3">
                        <div
                          class="w-8 h-8 bg-gradient-to-br from-green-100 to-green-200 rounded-full flex items-center justify-center"
                        >
                          <span class="text-xs font-semibold text-green-700">
                            {{ getInitials(report.workerName) }}
                          </span>
                        </div>
                        <div>
                          <p class="text-sm font-medium text-gray-900">
                            {{ report.workerName }}
                          </p>
                        </div>
                      </div>
                    </td>
                    <td class="px-6 py-4">
                      <span [class]="getSeverityBadgeClass(report.severity)">
                        {{ report.severity | titlecase }}
                      </span>
                    </td>
                    <td class="px-6 py-4">
                      <span [class]="getReportStatusBadgeClass(report.status)">
                        {{ report.status.replace('_', ' ') | titlecase }}
                      </span>
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-500">
                      {{ report.createdAt?.toDate() | date:'short' }}
                    </td>
                    <td class="px-6 py-4">
                      <button
                        (click)="viewReportDetails(report)"
                        class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors duration-200"
                      >
                        View Details
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>

              <!-- Empty State -->
              <div
                *ngIf="filteredReports.length === 0"
                class="text-center py-12"
              >
                <div
                  class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4"
                >
                  <ion-icon
                    name="flag-outline"
                    class="text-2xl text-gray-400"
                  ></ion-icon>
                </div>
                <h4 class="text-lg font-semibold text-gray-800 mb-2">
                  No reports found
                </h4>
                <p class="text-gray-500 text-sm">
                  {{ reportSearchTerm || reportStatusFilter !== 'all' ||
                  reportSeverityFilter !== 'all' ? 'Try adjusting your filters
                  to see more results.' : 'No reports have been submitted yet.'
                  }}
                </p>
              </div>
            </div>
          </div>

          <!-- Loading State -->
          <div *ngIf="isLoadingReports" class="text-center py-12">
            <div class="inline-flex items-center space-x-2">
              <div
                class="animate-spin rounded-full h-6 w-6 border-b-2 border-red-500"
              ></div>
              <span class="text-gray-600">Loading reports...</span>
            </div>
          </div>
        </div>

        <!-- Report Details Modal -->
        <div
          *ngIf="isReportModalOpen"
          class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50"
          (click)="closeReportModal()"
        >
          <div
            class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[95vh] overflow-hidden flex flex-col"
            (click)="$event.stopPropagation()"
          >
            <!-- Modal Header -->
            <div class="bg-gradient-to-r from-red-500 to-orange-500 px-6 py-4">
              <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                  <div
                    class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center"
                  >
                    <ion-icon name="flag" class="text-white text-xl"></ion-icon>
                  </div>
                  <div>
                    <h3 class="text-lg font-semibold text-white">
                      Report Details
                    </h3>
                    <div class="flex items-center space-x-3 mt-1">
                      <p class="text-red-100 text-sm">
                        {{ getReportTypeDisplayName(selectedReport?.reportType
                        || '') }}
                      </p>
                      <span
                        [class]="getReportStatusBadgeClass(selectedReport?.status || '')"
                      >
                        {{ selectedReport?.status?.replace('_', ' ') | titlecase
                        }}
                      </span>
                    </div>
                  </div>
                </div>
                <button
                  (click)="closeReportModal()"
                  class="p-2 rounded-full bg-white/20 hover:bg-white/30 transition-all duration-200"
                >
                  <ion-icon name="close" class="text-white text-xl"></ion-icon>
                </button>
              </div>
            </div>

            <!-- Modal Content -->
            <div class="overflow-y-auto flex-1">
              <div class="p-6 space-y-6">
                <!-- Report Information -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div class="bg-gray-50 rounded-xl p-4">
                    <h4 class="font-semibold text-gray-800 mb-3">
                      Client Information
                    </h4>
                    <div class="space-y-2">
                      <p class="text-sm">
                        <span class="font-medium">Name:</span> {{
                        selectedReport?.reporterName }}
                      </p>
                      <p class="text-sm">
                        <span class="font-medium">Email:</span> {{
                        selectedReport?.reporterEmail }}
                      </p>
                    </div>
                  </div>
                  <div class="bg-gray-50 rounded-xl p-4">
                    <h4 class="font-semibold text-gray-800 mb-3">
                      Worker Information
                    </h4>
                    <div class="space-y-2">
                      <p class="text-sm">
                        <span class="font-medium">Name:</span> {{
                        selectedReport?.workerName }}
                      </p>
                      <p class="text-sm">
                        <span class="font-medium">Worker ID:</span> {{
                        selectedReport?.workerId }}
                      </p>
                    </div>
                  </div>
                </div>

                <!-- Report Details -->
                <div class="bg-gray-50 rounded-xl p-4">
                  <h4 class="font-semibold text-gray-800 mb-3">
                    Report Details
                  </h4>
                  <div class="space-y-3">
                    <div class="flex items-center space-x-4">
                      <span
                        [class]="getSeverityBadgeClass(selectedReport?.severity || '')"
                      >
                        {{ selectedReport?.severity | titlecase }}
                      </span>
                      <span
                        [class]="getReportStatusBadgeClass(selectedReport?.status || '')"
                      >
                        {{ selectedReport?.status?.replace('_', ' ') | titlecase
                        }}
                      </span>
                    </div>

                    <!-- Status Transition Info -->
                    <div
                      class="bg-blue-50 border border-blue-200 rounded-lg p-3 mt-3"
                    >
                      <div class="flex items-start space-x-2">
                        <ion-icon
                          name="information-circle-outline"
                          class="text-blue-600 text-lg mt-0.5"
                        ></ion-icon>
                        <div class="text-sm text-blue-800">
                          <p class="font-medium mb-1">Available Actions:</p>
                          <div
                            *ngIf="selectedReport?.status === 'pending'"
                            class="text-blue-700"
                          >
                            â€¢ Start Review - Begin investigating this report<br />
                            â€¢ Dismiss - Close without further action
                          </div>
                          <div
                            *ngIf="selectedReport?.status === 'under_review'"
                            class="text-blue-700"
                          >
                            â€¢ Mark Resolved - Close as successfully resolved<br />
                            â€¢ Dismiss - Close without resolution
                          </div>
                          <div
                            *ngIf="selectedReport?.status === 'resolved'"
                            class="text-blue-700"
                          >
                            â€¢ Reopen for Review - Return to under review
                            status<br />
                            â€¢ Dismiss - Close permanently
                          </div>
                          <div
                            *ngIf="selectedReport?.status === 'dismissed'"
                            class="text-blue-700"
                          >
                            â€¢ Reopen for Review - Return to under review
                            status<br />
                            â€¢ Mark Resolved - Close as successfully resolved
                          </div>
                        </div>
                      </div>
                    </div>

                    <p class="text-sm">
                      <span class="font-medium">Title:</span> {{
                      selectedReport?.title }}
                    </p>
                    <p class="text-sm">
                      <span class="font-medium">Description:</span>
                    </p>
                    <p
                      class="text-sm text-gray-700 bg-white p-3 rounded-lg border"
                    >
                      {{ selectedReport?.description }}
                    </p>
                    <p class="text-sm">
                      <span class="font-medium">Submitted:</span> {{
                      selectedReport?.createdAt?.toDate() | date:'medium' }}
                    </p>
                  </div>
                </div>

                <!-- Evidence Images -->
                <div
                  *ngIf="selectedReport?.evidence"
                  class="bg-gray-50 rounded-xl p-4"
                >
                  <h4 class="font-semibold text-gray-800 mb-3">
                    Supporting Evidence
                  </h4>
                  <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div
                      *ngFor="let photo of selectedReport?.evidence?.photos || []"
                      class="relative"
                    >
                      <img
                        [src]="photo"
                        alt="Evidence photo"
                        class="w-full h-24 object-cover rounded-lg cursor-pointer hover:opacity-80 transition-opacity"
                        (click)="openImageInNewTab(photo, 'Evidence Photo')"
                      />
                    </div>
                    <div
                      *ngFor="let screenshot of selectedReport?.evidence?.screenshots || []"
                      class="relative"
                    >
                      <img
                        [src]="screenshot"
                        alt="Evidence screenshot"
                        class="w-full h-24 object-cover rounded-lg cursor-pointer hover:opacity-80 transition-opacity"
                        (click)="openImageInNewTab(screenshot, 'Evidence Screenshot')"
                      />
                    </div>
                  </div>
                </div>

                <!-- Admin Notes -->
                <div class="bg-gray-50 rounded-xl p-4">
                  <h4 class="font-semibold text-gray-800 mb-3">Admin Notes</h4>
                  <textarea
                    [(ngModel)]="reportAdminNotes"
                    placeholder="Add admin notes..."
                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"
                    rows="3"
                  ></textarea>
                </div>

                <!-- Resolution -->
                <div class="bg-gray-50 rounded-xl p-4">
                  <h4 class="font-semibold text-gray-800 mb-3">Resolution</h4>
                  <textarea
                    [(ngModel)]="reportResolution"
                    placeholder="Add resolution details..."
                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"
                    rows="3"
                  ></textarea>
                </div>
              </div>
            </div>

            <!-- Modal Footer -->
            <div
              class="bg-gray-50 px-6 py-4 flex flex-wrap items-center justify-between gap-3 border-t border-gray-200 mt-auto"
            >
              <button
                (click)="closeReportModal()"
                class="px-6 py-3 border border-gray-300 text-gray-700 font-semibold rounded-xl hover:bg-gray-100 transition-all duration-200"
              >
                <ion-icon name="close-outline" class="mr-2"></ion-icon>
                Close
              </button>

              <!-- Action Buttons based on current status -->
              <div class="flex flex-wrap gap-3">
                <!-- Pending Status Actions -->
                <ng-container *ngIf="selectedReport?.status === 'pending'">
                  <button
                    (click)="updateReportStatus('under_review')"
                    [disabled]="isProcessingReport"
                    class="px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white font-semibold rounded-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center"
                  >
                    <ion-icon name="eye-outline" class="mr-2"></ion-icon>
                    <span *ngIf="!isProcessingReport">Start Review</span>
                    <span *ngIf="isProcessingReport">Processing...</span>
                  </button>
                  <button
                    (click)="updateReportStatus('dismissed')"
                    [disabled]="isProcessingReport"
                    class="px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white font-semibold rounded-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center"
                  >
                    <ion-icon
                      name="close-circle-outline"
                      class="mr-2"
                    ></ion-icon>
                    <span *ngIf="!isProcessingReport">Dismiss</span>
                    <span *ngIf="isProcessingReport">Processing...</span>
                  </button>
                </ng-container>

                <!-- Under Review Status Actions -->
                <ng-container *ngIf="selectedReport?.status === 'under_review'">
                  <button
                    (click)="updateReportStatus('resolved')"
                    [disabled]="isProcessingReport"
                    class="px-6 py-3 bg-green-500 hover:bg-green-600 text-white font-semibold rounded-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center"
                  >
                    <ion-icon
                      name="checkmark-circle-outline"
                      class="mr-2"
                    ></ion-icon>
                    <span *ngIf="!isProcessingReport">Mark Resolved</span>
                    <span *ngIf="isProcessingReport">Processing...</span>
                  </button>
                  <button
                    (click)="updateReportStatus('dismissed')"
                    [disabled]="isProcessingReport"
                    class="px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white font-semibold rounded-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center"
                  >
                    <ion-icon
                      name="close-circle-outline"
                      class="mr-2"
                    ></ion-icon>
                    <span *ngIf="!isProcessingReport">Dismiss</span>
                    <span *ngIf="isProcessingReport">Processing...</span>
                  </button>
                </ng-container>

                <!-- Resolved Status Actions -->
                <ng-container *ngIf="selectedReport?.status === 'resolved'">
                  <button
                    (click)="updateReportStatus('under_review')"
                    [disabled]="isProcessingReport"
                    class="px-6 py-3 bg-orange-500 hover:bg-orange-600 text-white font-semibold rounded-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center"
                  >
                    <ion-icon name="refresh-outline" class="mr-2"></ion-icon>
                    <span *ngIf="!isProcessingReport">Reopen for Review</span>
                    <span *ngIf="isProcessingReport">Processing...</span>
                  </button>
                  <button
                    (click)="updateReportStatus('dismissed')"
                    [disabled]="isProcessingReport"
                    class="px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white font-semibold rounded-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center"
                  >
                    <ion-icon
                      name="close-circle-outline"
                      class="mr-2"
                    ></ion-icon>
                    <span *ngIf="!isProcessingReport">Dismiss</span>
                    <span *ngIf="isProcessingReport">Processing...</span>
                  </button>
                </ng-container>

                <!-- Dismissed Status Actions -->
                <ng-container *ngIf="selectedReport?.status === 'dismissed'">
                  <button
                    (click)="updateReportStatus('under_review')"
                    [disabled]="isProcessingReport"
                    class="px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white font-semibold rounded-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center"
                  >
                    <ion-icon name="refresh-outline" class="mr-2"></ion-icon>
                    <span *ngIf="!isProcessingReport">Reopen for Review</span>
                    <span *ngIf="isProcessingReport">Processing...</span>
                  </button>
                  <button
                    (click)="updateReportStatus('resolved')"
                    [disabled]="isProcessingReport"
                    class="px-6 py-3 bg-green-500 hover:bg-green-600 text-white font-semibold rounded-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center"
                  >
                    <ion-icon
                      name="checkmark-circle-outline"
                      class="mr-2"
                    ></ion-icon>
                    <span *ngIf="!isProcessingReport">Mark Resolved</span>
                    <span *ngIf="isProcessingReport">Processing...</span>
                  </button>
                </ng-container>

                <!-- Fallback: Show action buttons if no status matches (for debugging) -->
                <ng-container
                  *ngIf="selectedReport && selectedReport.status !== 'pending' && selectedReport.status !== 'under_review' && selectedReport.status !== 'resolved' && selectedReport.status !== 'dismissed'"
                >
                  <button
                    (click)="updateReportStatus('pending')"
                    [disabled]="isProcessingReport"
                    class="px-6 py-3 bg-purple-500 hover:bg-purple-600 text-white font-semibold rounded-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center"
                  >
                    <ion-icon name="refresh-outline" class="mr-2"></ion-icon>
                    <span *ngIf="!isProcessingReport">Reset to Pending</span>
                    <span *ngIf="isProcessingReport">Processing...</span>
                  </button>
                </ng-container>
              </div>
            </div>
          </div>
        </div>

        <!-- Client Reports Section -->
        <div *ngIf="reportViewType === 'client'">
          <!-- Similar structure as worker reports but for client reports -->
          <!-- Filters for Client Reports -->
          <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
              <!-- Search -->
              <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  Search Client Reports
                </label>
                <div class="relative">
                  <ion-icon
                    name="search"
                    class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"
                  ></ion-icon>
                  <input
                    type="text"
                    [(ngModel)]="clientReportSearchTerm"
                    (input)="filterClientReports()"
                    placeholder="Search by worker, client, or description..."
                    class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-transparent"
                  />
                </div>
              </div>

              <!-- Status Filter -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  Status
                </label>
                <select
                  [(ngModel)]="clientReportStatusFilter"
                  (change)="filterClientReports()"
                  class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-transparent"
                >
                  <option value="all">All Status</option>
                  <option value="pending">Pending</option>
                  <option value="under_review">Under Review</option>
                  <option value="resolved">Resolved</option>
                  <option value="dismissed">Dismissed</option>
                </select>
              </div>

              <!-- Severity Filter -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  Severity
                </label>
                <select
                  [(ngModel)]="clientReportSeverityFilter"
                  (change)="filterClientReports()"
                  class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-transparent"
                >
                  <option value="all">All Severity</option>
                  <option value="low">Low</option>
                  <option value="medium">Medium</option>
                  <option value="high">High</option>
                  <option value="critical">Critical</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Client Reports Table -->
          <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                  <tr>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Client
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Reporter (Worker)
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Issue Type
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Severity
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Status
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Date
                    </th>
                    <th
                      class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Actions
                    </th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                  <tr
                    *ngFor="let report of filteredClientReports"
                    class="hover:bg-gray-50"
                  >
                    <td class="px-6 py-4 whitespace-nowrap">
                      <div class="flex items-center">
                        <div
                          class="flex-shrink-0 h-10 w-10 bg-red-100 rounded-full flex items-center justify-center"
                        >
                          <ion-icon
                            name="person"
                            class="text-red-600"
                          ></ion-icon>
                        </div>
                        <div class="ml-4">
                          <div class="text-sm font-medium text-gray-900">
                            {{ report.clientName }}
                          </div>
                        </div>
                      </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <div class="text-sm text-gray-900">
                        {{ report.reporterName }}
                      </div>
                      <div class="text-sm text-gray-500">
                        {{ report.reporterEmail }}
                      </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <div class="text-sm text-gray-900">
                        {{ report.title }}
                      </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <span [class]="getSeverityBadgeClass(report.severity)">
                        {{ report.severity | titlecase }}
                      </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <span [class]="getReportStatusBadgeClass(report.status)">
                        {{ report.status | titlecase }}
                      </span>
                    </td>
                    <td
                      class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"
                    >
                      {{ report.createdAt?.toDate() | date:'short' }}
                    </td>
                    <td
                      class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium"
                    >
                      <button
                        (click)="viewClientReportDetails(report)"
                        class="text-red-600 hover:text-red-900 mr-3"
                      >
                        View
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>

              <!-- Empty State -->
              <div
                *ngIf="filteredClientReports.length === 0"
                class="text-center py-12"
              >
                <ion-icon
                  name="document-text"
                  class="text-gray-400 text-5xl mb-4"
                ></ion-icon>
                <h3 class="text-lg font-medium text-gray-900 mb-2">
                  No Client Reports Found
                </h3>
                <p class="text-gray-500">
                  {{ clientReportSearchTerm ? 'Try adjusting your search
                  filters' : 'No client reports have been submitted yet' }}
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Client Report Details Modal -->
      <div
        *ngIf="isClientReportModalOpen"
        class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50"
        (click)="closeClientReportModal()"
      >
        <div
          class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[95vh] overflow-hidden flex flex-col"
          (click)="$event.stopPropagation()"
        >
          <!-- Modal Header -->
          <div class="bg-gradient-to-r from-orange-500 to-red-500 px-6 py-4">
            <div class="flex items-center justify-between">
              <div class="flex items-center space-x-3">
                <div
                  class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center"
                >
                  <ion-icon
                    name="person-remove"
                    class="text-white text-xl"
                  ></ion-icon>
                </div>
                <div>
                  <h3 class="text-lg font-semibold text-white">
                    Client Report Details
                  </h3>
                  <div class="flex items-center space-x-3 mt-1">
                    <p class="text-orange-100 text-sm">
                      {{ selectedClientReport?.reportType || 'Report' }}
                    </p>
                    <span
                      [class]="getReportStatusBadgeClass(selectedClientReport?.status || '')"
                    >
                      {{ selectedClientReport?.status?.replace('_', ' ') |
                      titlecase }}
                    </span>
                  </div>
                </div>
              </div>
              <button
                (click)="closeClientReportModal()"
                class="p-2 rounded-full bg-white/20 hover:bg-white/30 transition-all duration-200"
              >
                <ion-icon name="close" class="text-white text-xl"></ion-icon>
              </button>
            </div>
          </div>

          <!-- Modal Content -->
          <div class="overflow-y-auto flex-1">
            <div class="p-6 space-y-6">
              <!-- Report Information -->
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-gray-50 rounded-xl p-4">
                  <h4 class="font-semibold text-gray-800 mb-3">
                    Client Information
                  </h4>
                  <div class="space-y-2 text-sm">
                    <div class="flex justify-between">
                      <span class="text-gray-600">Client Name:</span>
                      <span class="font-medium"
                        >{{ selectedClientReport?.clientName }}</span
                      >
                    </div>
                    <div class="flex justify-between">
                      <span class="text-gray-600">Client ID:</span>
                      <span class="font-medium font-mono text-xs"
                        >{{ selectedClientReport?.clientId }}</span
                      >
                    </div>
                  </div>
                </div>

                <div class="bg-gray-50 rounded-xl p-4">
                  <h4 class="font-semibold text-gray-800 mb-3">
                    Reporter Information
                  </h4>
                  <div class="space-y-2 text-sm">
                    <div class="flex justify-between">
                      <span class="text-gray-600">Worker Name:</span>
                      <span class="font-medium"
                        >{{ selectedClientReport?.reporterName }}</span
                      >
                    </div>
                    <div class="flex justify-between">
                      <span class="text-gray-600">Email:</span>
                      <span class="font-medium"
                        >{{ selectedClientReport?.reporterEmail }}</span
                      >
                    </div>
                  </div>
                </div>
              </div>

              <!-- Report Details -->
              <div
                class="bg-gradient-to-r from-orange-50 to-red-50 rounded-xl p-6 border border-orange-200"
              >
                <div class="flex items-center space-x-3 mb-4">
                  <ion-icon
                    name="document-text"
                    class="text-orange-600 text-2xl"
                  ></ion-icon>
                  <h4 class="text-lg font-bold text-gray-800">
                    Report Description
                  </h4>
                </div>
                <h5 class="font-semibold text-gray-800 mb-2">
                  {{ selectedClientReport?.title }}
                </h5>
                <p class="text-gray-700 leading-relaxed">
                  {{ selectedClientReport?.description }}
                </p>
              </div>

              <!-- Report Metadata -->
              <div class="grid grid-cols-3 gap-4">
                <div class="bg-white rounded-lg p-4 border border-gray-200">
                  <div class="flex items-center space-x-2 mb-2">
                    <ion-icon
                      name="alert-circle"
                      class="text-orange-600"
                    ></ion-icon>
                    <h5 class="font-semibold text-gray-700">Severity</h5>
                  </div>
                  <span
                    [class]="getSeverityBadgeClass(selectedClientReport?.severity)"
                  >
                    {{ selectedClientReport?.severity | titlecase }}
                  </span>
                </div>

                <div class="bg-white rounded-lg p-4 border border-gray-200">
                  <div class="flex items-center space-x-2 mb-2">
                    <ion-icon name="calendar" class="text-blue-600"></ion-icon>
                    <h5 class="font-semibold text-gray-700">Created</h5>
                  </div>
                  <p class="text-sm text-gray-600">
                    {{ selectedClientReport?.createdAt?.toDate() | date:'short'
                    }}
                  </p>
                </div>

                <div class="bg-white rounded-lg p-4 border border-gray-200">
                  <div class="flex items-center space-x-2 mb-2">
                    <ion-icon
                      name="document-text"
                      class="text-purple-600"
                    ></ion-icon>
                    <h5 class="font-semibold text-gray-700">Report Type</h5>
                  </div>
                  <p class="text-sm text-gray-600 capitalize">
                    {{ selectedClientReport?.reportType?.replace('_', ' ') }}
                  </p>
                </div>
              </div>

              <!-- Booking Reference -->
              <div
                *ngIf="selectedClientReport?.bookingId"
                class="bg-blue-50 rounded-xl p-4 border border-blue-200"
              >
                <div class="flex items-center space-x-2 mb-2">
                  <ion-icon
                    name="calendar-outline"
                    class="text-blue-600"
                  ></ion-icon>
                  <h5 class="font-semibold text-gray-800">Related Booking</h5>
                </div>
                <p class="text-sm font-mono text-gray-700">
                  {{ selectedClientReport.bookingId }}
                </p>
              </div>

              <!-- Evidence -->
              <div *ngIf="selectedClientReport?.evidence" class="space-y-4">
                <!-- Photos -->
                <div
                  *ngIf="selectedClientReport.evidence.photos && selectedClientReport.evidence.photos.length > 0"
                >
                  <h5
                    class="font-semibold text-gray-800 mb-3 flex items-center"
                  >
                    <ion-icon
                      name="images"
                      class="mr-2 text-blue-600"
                    ></ion-icon>
                    Photos of the Issue
                  </h5>
                  <div class="grid grid-cols-3 gap-3">
                    <img
                      *ngFor="let photo of selectedClientReport.evidence.photos"
                      [src]="photo"
                      alt="Evidence"
                      class="w-full h-32 object-cover rounded-lg border border-gray-200"
                      (click)="openImageInNewTab(photo, 'Evidence Photo')"
                      style="cursor: pointer"
                    />
                  </div>
                </div>

                <!-- Screenshots -->
                <div
                  *ngIf="selectedClientReport.evidence.screenshots && selectedClientReport.evidence.screenshots.length > 0"
                >
                  <h5
                    class="font-semibold text-gray-800 mb-3 flex items-center"
                  >
                    <ion-icon
                      name="phone-portrait"
                      class="mr-2 text-green-600"
                    ></ion-icon>
                    Screenshots
                  </h5>
                  <div class="grid grid-cols-3 gap-3">
                    <img
                      *ngFor="let screenshot of selectedClientReport.evidence.screenshots"
                      [src]="screenshot"
                      alt="Screenshot"
                      class="w-full h-32 object-cover rounded-lg border border-gray-200"
                      (click)="openImageInNewTab(screenshot, 'Screenshot Evidence')"
                      style="cursor: pointer"
                    />
                  </div>
                </div>
              </div>

              <!-- Admin Notes -->
              <div class="bg-gray-50 rounded-xl p-4 border border-gray-200">
                <h5 class="font-semibold text-gray-800 mb-3">Admin Notes</h5>
                <textarea
                  [(ngModel)]="reportAdminNotes"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent resize-none"
                  rows="3"
                  placeholder="Add notes about this report..."
                ></textarea>
              </div>

              <!-- Resolution -->
              <div class="bg-green-50 rounded-xl p-4 border border-green-200">
                <h5 class="font-semibold text-gray-800 mb-3">Resolution</h5>
                <textarea
                  [(ngModel)]="reportResolution"
                  class="w-full px-4 py-3 border border-green-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none"
                  rows="3"
                  placeholder="Resolution or action taken..."
                ></textarea>
              </div>
            </div>
          </div>

          <!-- Modal Footer -->
          <div
            class="bg-gray-50 px-6 py-4 flex flex-wrap items-center justify-between gap-3 border-t border-gray-200 mt-auto"
          >
            <button
              (click)="closeClientReportModal()"
              class="px-6 py-3 border border-gray-300 text-gray-700 font-semibold rounded-xl hover:bg-gray-100 transition-all duration-200"
            >
              <ion-icon name="close-outline" class="mr-2"></ion-icon>
              Close
            </button>

            <!-- Action Buttons based on current status -->
            <div class="flex flex-wrap gap-3">
              <!-- Pending Status Actions -->
              <ng-container *ngIf="selectedClientReport?.status === 'pending'">
                <button
                  (click)="updateClientReportStatus('under_review')"
                  [disabled]="isProcessingReport"
                  class="px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white font-semibold rounded-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center"
                >
                  <ion-icon name="eye-outline" class="mr-2"></ion-icon>
                  <span *ngIf="!isProcessingReport">Start Review</span>
                  <span *ngIf="isProcessingReport">Processing...</span>
                </button>
                <button
                  (click)="updateClientReportStatus('dismissed')"
                  [disabled]="isProcessingReport"
                  class="px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white font-semibold rounded-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center"
                >
                  <ion-icon name="close-circle-outline" class="mr-2"></ion-icon>
                  <span *ngIf="!isProcessingReport">Dismiss</span>
                  <span *ngIf="isProcessingReport">Processing...</span>
                </button>
              </ng-container>

              <!-- Under Review Status Actions -->
              <ng-container
                *ngIf="selectedClientReport?.status === 'under_review'"
              >
                <button
                  (click)="updateClientReportStatus('resolved')"
                  [disabled]="isProcessingReport"
                  class="px-6 py-3 bg-green-500 hover:bg-green-600 text-white font-semibold rounded-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center"
                >
                  <ion-icon
                    name="checkmark-circle-outline"
                    class="mr-2"
                  ></ion-icon>
                  <span *ngIf="!isProcessingReport">Mark Resolved</span>
                  <span *ngIf="isProcessingReport">Processing...</span>
                </button>
                <button
                  (click)="updateClientReportStatus('dismissed')"
                  [disabled]="isProcessingReport"
                  class="px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white font-semibold rounded-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center"
                >
                  <ion-icon name="close-circle-outline" class="mr-2"></ion-icon>
                  <span *ngIf="!isProcessingReport">Dismiss</span>
                  <span *ngIf="isProcessingReport">Processing...</span>
                </button>
              </ng-container>

              <!-- Resolved Status Actions -->
              <ng-container *ngIf="selectedClientReport?.status === 'resolved'">
                <button
                  (click)="updateClientReportStatus('under_review')"
                  [disabled]="isProcessingReport"
                  class="px-6 py-3 bg-orange-500 hover:bg-orange-600 text-white font-semibold rounded-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center"
                >
                  <ion-icon name="refresh-outline" class="mr-2"></ion-icon>
                  <span *ngIf="!isProcessingReport">Reopen for Review</span>
                  <span *ngIf="isProcessingReport">Processing...</span>
                </button>
                <button
                  (click)="updateClientReportStatus('dismissed')"
                  [disabled]="isProcessingReport"
                  class="px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white font-semibold rounded-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center"
                >
                  <ion-icon name="close-circle-outline" class="mr-2"></ion-icon>
                  <span *ngIf="!isProcessingReport">Dismiss</span>
                  <span *ngIf="isProcessingReport">Processing...</span>
                </button>
              </ng-container>

              <!-- Dismissed Status Actions -->
              <ng-container
                *ngIf="selectedClientReport?.status === 'dismissed'"
              >
                <button
                  (click)="updateClientReportStatus('under_review')"
                  [disabled]="isProcessingReport"
                  class="px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white font-semibold rounded-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center"
                >
                  <ion-icon name="refresh-outline" class="mr-2"></ion-icon>
                  <span *ngIf="!isProcessingReport">Reopen for Review</span>
                  <span *ngIf="isProcessingReport">Processing...</span>
                </button>
                <button
                  (click)="updateClientReportStatus('resolved')"
                  [disabled]="isProcessingReport"
                  class="px-6 py-3 bg-green-500 hover:bg-green-600 text-white font-semibold rounded-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center"
                >
                  <ion-icon
                    name="checkmark-circle-outline"
                    class="mr-2"
                  ></ion-icon>
                  <span *ngIf="!isProcessingReport">Mark Resolved</span>
                  <span *ngIf="isProcessingReport">Processing...</span>
                </button>
              </ng-container>
            </div>
          </div>
        </div>
      </div>

      <!-- Services Management Section -->
      <div *ngIf="activeSection === 'services'" class="animate-fadeIn">
        <!-- Enhanced Header with Gradient Background -->
        <div
          class="relative bg-gradient-to-br from-red-50 via-red-100 to-orange-50 rounded-2xl p-8 mb-8 overflow-hidden"
        >
          <!-- Background Pattern -->
          <div class="absolute inset-0 opacity-5">
            <div
              class="absolute top-4 left-4 w-32 h-32 bg-red-500 rounded-full blur-3xl"
            ></div>
            <div
              class="absolute bottom-4 right-4 w-20 h-20 bg-orange-500 rounded-full blur-2xl"
            ></div>
            <div
              class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-40 h-40 bg-red-400 rounded-full blur-3xl"
            ></div>
          </div>

          <div class="relative z-10">
            <div
              class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6"
            >
              <div class="flex-1">
                <div class="flex items-center mb-4">
                  <div
                    class="bg-white/20 backdrop-blur-sm p-3 rounded-xl mr-4 shadow-lg"
                  >
                    <ion-icon
                      name="construct"
                      class="text-3xl text-red-600"
                    ></ion-icon>
                  </div>
                  <div>
                    <h2 class="text-3xl font-bold text-gray-800 mb-1">
                      Services Management
                    </h2>
                    <div class="flex items-center text-gray-600">
                      <ion-icon
                        name="layers-outline"
                        class="mr-2 text-lg"
                      ></ion-icon>
                      <span>Manage all services offered by HandyHome</span>
                    </div>
                  </div>
                </div>

                <!-- Quick Stats -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
                  <div
                    class="bg-white/30 backdrop-blur-sm rounded-xl p-4 border border-white/20"
                  >
                    <div class="flex items-center justify-between">
                      <div>
                        <p class="text-2xl font-bold text-gray-800">
                          {{ serviceCategories.length }}
                        </p>
                        <p class="text-sm text-gray-600">Total Services</p>
                      </div>
                      <div class="bg-blue-100 p-2 rounded-lg">
                        <ion-icon
                          name="grid-outline"
                          class="text-blue-600 text-xl"
                        ></ion-icon>
                      </div>
                    </div>
                  </div>

                  <div
                    class="bg-white/30 backdrop-blur-sm rounded-xl p-4 border border-white/20"
                  >
                    <div class="flex items-center justify-between">
                      <div>
                        <p class="text-2xl font-bold text-green-700">
                          {{ getActiveServicesCount() }}
                        </p>
                        <p class="text-sm text-gray-600">Active Services</p>
                      </div>
                      <div class="bg-green-100 p-2 rounded-lg">
                        <ion-icon
                          name="checkmark-circle-outline"
                          class="text-green-600 text-xl"
                        ></ion-icon>
                      </div>
                    </div>
                  </div>

                  <div
                    class="bg-white/30 backdrop-blur-sm rounded-xl p-4 border border-white/20"
                  >
                    <div class="flex items-center justify-between">
                      <div>
                        <p class="text-2xl font-bold text-red-700">
                          {{ getInactiveServicesCount() }}
                        </p>
                        <p class="text-sm text-gray-600">Inactive Services</p>
                      </div>
                      <div class="bg-red-100 p-2 rounded-lg">
                        <ion-icon
                          name="pause-circle-outline"
                          class="text-red-600 text-xl"
                        ></ion-icon>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Action Button -->
              <div class="flex-shrink-0">
                <button
                  (click)="openAddServiceModal()"
                  class="group bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white px-8 py-4 rounded-2xl flex items-center transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl"
                >
                  <div
                    class="bg-white/20 rounded-lg p-2 mr-3 group-hover:bg-white/30 transition-colors"
                  >
                    <ion-icon name="add" class="text-xl"></ion-icon>
                  </div>
                  <div class="text-left">
                    <div class="font-semibold">Add New Service</div>
                    <div class="text-sm text-red-100">
                      Create service category
                    </div>
                  </div>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Enhanced Loading State -->
        <div
          *ngIf="isLoadingServices"
          class="flex flex-col items-center justify-center py-16"
        >
          <div class="relative">
            <div
              class="w-16 h-16 border-4 border-red-200 border-t-red-600 rounded-full animate-spin"
            ></div>
            <div
              class="absolute inset-0 w-16 h-16 border-4 border-transparent border-r-red-400 rounded-full animate-spin animation-delay-150"
            ></div>
          </div>
          <div class="mt-6 text-center">
            <h3 class="text-lg font-semibold text-gray-700 mb-2">
              Loading Services
            </h3>
            <p class="text-gray-500">
              Please wait while we fetch your service data...
            </p>
          </div>
        </div>

        <!-- Services Grid -->
        <div
          *ngIf="!isLoadingServices"
          class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"
        >
          <div
            *ngFor="let service of serviceCategories"
            class="group relative bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-500 border border-gray-100 overflow-hidden transform hover:-translate-y-2"
          >
            <!-- Card Background Gradient -->
            <div
              class="absolute inset-0 bg-gradient-to-br opacity-0 group-hover:opacity-5 transition-opacity duration-500"
              [style.background]="'linear-gradient(135deg, ' + service.color + ', ' + service.color + '99)'"
            ></div>

            <!-- Card Content -->
            <div class="relative z-10 p-6">
              <!-- Service Header -->
              <div class="flex items-start justify-between mb-5">
                <div class="flex items-start flex-1">
                  <!-- Enhanced Icon Container -->
                  <div class="relative mr-4">
                    <div
                      [style.background]="'linear-gradient(135deg, ' + service.color + ', ' + service.color + 'cc)'"
                      class="w-16 h-16 rounded-2xl flex items-center justify-center text-white shadow-lg group-hover:shadow-xl transition-all duration-300 transform group-hover:scale-110"
                    >
                      <ion-icon
                        [name]="service.icon"
                        class="text-2xl"
                      ></ion-icon>
                    </div>
                    <!-- Status Indicator -->
                    <div
                      class="absolute -top-1 -right-1 w-6 h-6 rounded-full border-2 border-white shadow-sm"
                      [class]="service.isActive ? 'bg-green-500' : 'bg-gray-400'"
                    ></div>
                  </div>

                  <div class="flex-1 min-w-0">
                    <h3
                      class="font-bold text-xl text-gray-800 mb-1 group-hover:text-gray-900 transition-colors truncate"
                    >
                      {{ service.name }}
                    </h3>
                    <div class="flex items-center mb-2">
                      <span
                        [class]="service.isActive 
                        ? 'bg-gradient-to-r from-green-100 to-green-200 text-green-800 border-green-300' 
                        : 'bg-gradient-to-r from-red-100 to-red-200 text-red-800 border-red-300'"
                        class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold border"
                      >
                        <div
                          class="w-2 h-2 rounded-full mr-2"
                          [class]="service.isActive ? 'bg-green-500' : 'bg-red-500'"
                        ></div>
                        {{ service.isActive ? 'Active' : 'Inactive' }}
                      </span>
                    </div>
                  </div>
                </div>

                <!-- Action Menu -->
                <div
                  class="flex items-center space-x-1 opacity-0 group-hover:opacity-100 transition-all duration-300 transform translate-x-2 group-hover:translate-x-0"
                >
                  <button
                    (click)="editService(service)"
                    class="p-2 text-blue-600 hover:bg-blue-50 rounded-xl transition-all duration-200 hover:scale-110"
                    title="Edit Service"
                  >
                    <ion-icon name="pencil" class="text-lg"></ion-icon>
                  </button>
                  <button
                    (click)="toggleServiceStatus(service)"
                    [class]="service.isActive 
                      ? 'text-amber-600 hover:bg-amber-50' 
                      : 'text-green-600 hover:bg-green-50'"
                    class="p-2 rounded-xl transition-all duration-200 hover:scale-110"
                    [title]="service.isActive ? 'Deactivate Service' : 'Activate Service'"
                  >
                    <ion-icon
                      [name]="service.isActive ? 'pause-circle' : 'play-circle'"
                      class="text-lg"
                    ></ion-icon>
                  </button>
                  <button
                    (click)="deleteService(service)"
                    class="p-2 text-red-600 hover:bg-red-50 rounded-xl transition-all duration-200 hover:scale-110"
                    title="Delete Service"
                  >
                    <ion-icon name="trash" class="text-lg"></ion-icon>
                  </button>
                </div>
              </div>

              <!-- Service Description -->
              <p
                class="text-gray-600 text-sm mb-5 line-clamp-3 leading-relaxed"
              >
                {{ service.description }}
              </p>

              <!-- Sub-services Preview -->
              <div
                *ngIf="service.services && service.services.length > 0"
                class="mb-4"
              >
                <div class="flex items-center justify-between mb-3">
                  <p
                    class="text-xs text-gray-500 font-medium uppercase tracking-wide"
                  >
                    Sub-services
                  </p>
                  <span
                    class="bg-blue-100 text-blue-800 text-xs font-semibold px-2 py-1 rounded-full"
                  >
                    {{ service.services.length }}
                  </span>
                </div>
                <div class="flex flex-wrap gap-2">
                  <div
                    *ngFor="let subService of service.services.slice(0, 3); let i = index"
                    class="inline-flex flex-col items-start"
                  >
                    <span
                      class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gradient-to-r from-blue-50 to-indigo-50 text-blue-700 border border-blue-200 hover:from-blue-100 hover:to-indigo-100 transition-colors"
                    >
                      {{ subService }}
                    </span>
                    <span
                      *ngIf="service.servicesPricing && service.servicesPricing[i]"
                      class="text-xs text-gray-500 mt-1 px-2 py-0.5 bg-green-50 text-green-600 rounded-full border border-green-200"
                    >
                      {{ service.servicesPricing[i] === 'per_hour' ? 'Per Hour'
                      : 'Per Day' }}
                    </span>
                    <span
                      *ngIf="service.servicesQuickBookingPricing && service.servicesQuickBookingPricing[i] !== undefined && service.servicesQuickBookingPricing[i] > 0"
                      class="text-xs text-gray-500 mt-1 px-2 py-0.5 bg-purple-50 text-purple-600 rounded-full border border-purple-200"
                    >
                      â‚±{{ service.servicesQuickBookingPricing[i] |
                      number:'1.2-2' }}
                      <span class="ml-1 text-purple-500">
                        {{ service.servicesQuickBookingUnit &&
                        service.servicesQuickBookingUnit[i] ?
                        (service.servicesQuickBookingUnit[i] === 'per_hour' ?
                        '/hr' : '/day') : '/hr' }}
                      </span>
                    </span>
                  </div>
                  <span
                    *ngIf="service.services.length > 3"
                    class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-gradient-to-r from-indigo-100 to-purple-100 text-indigo-700 border border-indigo-200 cursor-pointer hover:from-indigo-200 hover:to-purple-200 transition-colors"
                    [title]="service.services.slice(3).join(', ')"
                  >
                    +{{ service.services.length - 3 }} more
                  </span>
                </div>
              </div>

              <!-- Requirements -->
              <div
                *ngIf="service.requirements && service.requirements.length > 0"
                class="mb-4"
              >
                <div class="flex items-center justify-between mb-3">
                  <p
                    class="text-xs text-gray-500 font-medium uppercase tracking-wide"
                  >
                    Requirements
                  </p>
                  <span
                    class="bg-amber-100 text-amber-800 text-xs font-semibold px-2 py-1 rounded-full"
                  >
                    {{ service.requirements.length }}
                  </span>
                </div>
                <div class="flex flex-wrap gap-2">
                  <span
                    *ngFor="let requirement of service.requirements.slice(0, 2)"
                    class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gradient-to-r from-amber-50 to-yellow-50 text-amber-700 border border-amber-200 hover:from-amber-100 hover:to-yellow-100 transition-colors"
                  >
                    <ion-icon
                      name="shield-checkmark"
                      class="text-xs mr-1"
                    ></ion-icon>
                    {{ requirement }}
                  </span>
                  <span
                    *ngIf="service.requirements.length > 2"
                    class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-gradient-to-r from-yellow-100 to-orange-100 text-yellow-700 border border-yellow-200 cursor-pointer hover:from-yellow-200 hover:to-orange-200 transition-colors"
                    [title]="service.requirements.slice(2).join(', ')"
                  >
                    +{{ service.requirements.length - 2 }} more
                  </span>
                </div>
              </div>

              <!-- Certificate Requirement Badge -->
              <div *ngIf="service.requiresCertificate" class="mb-4">
                <div class="flex items-center justify-between mb-3">
                  <p
                    class="text-xs text-gray-500 font-medium uppercase tracking-wide"
                  >
                    Certificate
                  </p>
                </div>
                <div class="flex items-center">
                  <span
                    class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gradient-to-r from-orange-50 to-red-50 text-orange-700 border border-orange-200"
                  >
                    <ion-icon name="document" class="text-xs mr-1"></ion-icon>
                    Certificate Required
                  </span>
                </div>
              </div>

              <!-- Card Footer Action -->
              <div class="pt-4 border-t border-gray-100">
                <button
                  (click)="editService(service)"
                  class="w-full bg-gradient-to-r from-gray-50 to-gray-100 hover:from-gray-100 hover:to-gray-200 text-gray-700 font-medium py-3 px-4 rounded-xl transition-all duration-200 flex items-center justify-center group-hover:shadow-md border border-gray-200"
                >
                  <ion-icon name="settings-outline" class="mr-2"></ion-icon>
                  Manage Service
                </button>
              </div>
            </div>
          </div>

          <!-- Add New Service Card -->
          <div
            (click)="openAddServiceModal()"
            class="group relative bg-gradient-to-br from-gray-50 via-white to-gray-100 border-2 border-dashed border-gray-300 rounded-2xl hover:border-red-400 hover:from-red-50 hover:via-red-25 hover:to-orange-50 transition-all duration-500 p-8 flex flex-col items-center justify-center cursor-pointer min-h-[400px] transform hover:scale-105 hover:shadow-xl"
          >
            <!-- Background Pattern -->
            <div
              class="absolute inset-0 opacity-0 group-hover:opacity-10 transition-opacity duration-500"
            >
              <div
                class="absolute top-4 right-4 w-20 h-20 bg-red-500 rounded-full blur-2xl"
              ></div>
              <div
                class="absolute bottom-4 left-4 w-16 h-16 bg-orange-500 rounded-full blur-xl"
              ></div>
            </div>

            <div class="relative z-10 text-center">
              <!-- Animated Icon -->
              <div class="relative mb-6">
                <div
                  class="bg-gradient-to-br from-red-100 to-red-200 group-hover:from-red-500 group-hover:to-red-600 w-20 h-20 rounded-2xl flex items-center justify-center transition-all duration-300 transform group-hover:scale-110 shadow-lg group-hover:shadow-xl"
                >
                  <ion-icon
                    name="add-circle"
                    class="text-4xl text-red-500 group-hover:text-white transition-colors duration-300"
                  ></ion-icon>
                </div>
                <!-- Pulse Ring -->
                <div
                  class="absolute inset-0 rounded-2xl border-2 border-red-300 opacity-0 group-hover:opacity-100 animate-ping"
                ></div>
              </div>

              <h3
                class="font-bold text-xl text-gray-700 group-hover:text-red-700 mb-3 transition-colors duration-300"
              >
                Add New Service
              </h3>
              <p
                class="text-gray-500 group-hover:text-gray-600 text-center leading-relaxed max-w-xs transition-colors duration-300"
              >
                Create a new service category to expand HandyHome's offerings
              </p>

              <!-- Features List -->
              <div
                class="mt-6 space-y-2 opacity-0 group-hover:opacity-100 transition-all duration-500 transform translate-y-2 group-hover:translate-y-0"
              >
                <div
                  class="flex items-center justify-center text-sm text-gray-600"
                >
                  <ion-icon
                    name="checkmark-circle"
                    class="text-green-500 mr-2"
                  ></ion-icon>
                  Custom icons & colors
                </div>
                <div
                  class="flex items-center justify-center text-sm text-gray-600"
                >
                  <ion-icon
                    name="checkmark-circle"
                    class="text-green-500 mr-2"
                  ></ion-icon>
                  Sub-services management
                </div>
                <div
                  class="flex items-center justify-center text-sm text-gray-600"
                >
                  <ion-icon
                    name="checkmark-circle"
                    class="text-green-500 mr-2"
                  ></ion-icon>
                  Requirements tracking
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Client Management Section -->
      <div *ngIf="activeSection === 'clients'" class="animate-fadeIn">
        <!-- Enhanced Header -->
        <div
          class="relative bg-gradient-to-br from-blue-50 via-blue-100 to-indigo-50 rounded-2xl p-8 mb-8 overflow-hidden"
        >
          <!-- Background Pattern -->
          <div class="absolute inset-0 opacity-5">
            <div
              class="absolute top-4 left-4 w-32 h-32 bg-blue-500 rounded-full blur-3xl"
            ></div>
            <div
              class="absolute bottom-4 right-4 w-24 h-24 bg-indigo-500 rounded-full blur-2xl"
            ></div>
          </div>

          <div class="relative z-10">
            <div class="flex items-center justify-between">
              <div class="flex items-center">
                <div
                  class="bg-gradient-to-br from-blue-500 to-blue-600 w-16 h-16 rounded-2xl flex items-center justify-center text-white mr-6 shadow-lg"
                >
                  <ion-icon name="people" class="text-3xl"></ion-icon>
                </div>
                <div>
                  <h1 class="text-3xl font-bold text-gray-800">
                    Client Management
                  </h1>
                  <p class="text-gray-600 text-lg">
                    Manage all registered clients and their information
                  </p>
                </div>
              </div>
              <div class="flex items-center space-x-4">
                <div class="bg-white rounded-xl px-6 py-3 shadow-md">
                  <div class="text-2xl font-bold text-blue-600">
                    {{ clients.length }}
                  </div>
                  <div class="text-sm text-gray-600">Total Clients</div>
                </div>
                <div class="bg-white rounded-xl px-6 py-3 shadow-md">
                  <div class="text-2xl font-bold text-green-600">
                    {{ filteredClients.length }}
                  </div>
                  <div class="text-sm text-gray-600">Showing</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Search and Filters -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
          <div class="flex items-center justify-between">
            <div class="flex-1 max-w-md">
              <div class="relative">
                <input
                  type="text"
                  [(ngModel)]="clientSearchTerm"
                  (ngModelChange)="filterClients()"
                  placeholder="Search clients by name, email, or phone..."
                  class="w-full px-4 py-3 pl-12 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-200 bg-gray-50 focus:bg-white"
                />
                <div class="absolute inset-y-0 left-0 flex items-center pl-4">
                  <ion-icon
                    name="search"
                    class="text-gray-400 text-xl"
                  ></ion-icon>
                </div>
              </div>
            </div>
            <div class="flex items-center space-x-3">
              <button
                (click)="loadClients()"
                [disabled]="isLoadingClients"
                class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors flex items-center"
              >
                <ion-icon
                  [name]="isLoadingClients ? 'hourglass' : 'refresh'"
                  class="mr-2"
                ></ion-icon>
                {{ isLoadingClients ? 'Loading...' : 'Refresh' }}
              </button>
            </div>
          </div>
        </div>

        <!-- Clients Table -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden">
          <div class="overflow-x-auto">
            <table class="w-full">
              <!-- Table Header -->
              <thead class="bg-gray-50 border-b border-gray-200">
                <tr>
                  <th
                    class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"
                  >
                    Client Info
                  </th>
                  <th
                    class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"
                  >
                    Contact Details
                  </th>
                  <th
                    class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"
                  >
                    Registration Date
                  </th>
                  <th
                    class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"
                  >
                    Saved Locations
                  </th>
                  <th
                    class="px-6 py-4 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider"
                  >
                    Actions
                  </th>
                </tr>
              </thead>

              <!-- Table Body -->
              <tbody class="divide-y divide-gray-200">
                <!-- Loading State -->
                <tr *ngIf="isLoadingClients">
                  <td colspan="5" class="px-6 py-12 text-center">
                    <div class="flex items-center justify-center">
                      <ion-icon
                        name="hourglass"
                        class="text-3xl text-gray-400 mr-3 animate-spin"
                      ></ion-icon>
                      <span class="text-gray-500 text-lg"
                        >Loading clients...</span
                      >
                    </div>
                  </td>
                </tr>

                <!-- No Clients Found -->
                <tr *ngIf="!isLoadingClients && filteredClients.length === 0">
                  <td colspan="5" class="px-6 py-12 text-center">
                    <div class="flex flex-col items-center">
                      <ion-icon
                        name="people-outline"
                        class="text-6xl text-gray-300 mb-4"
                      ></ion-icon>
                      <h3 class="text-xl font-semibold text-gray-600 mb-2">
                        No Clients Found
                      </h3>
                      <p class="text-gray-500">
                        {{ clientSearchTerm ? 'Try adjusting your search
                        criteria' : 'No clients have registered yet' }}
                      </p>
                    </div>
                  </td>
                </tr>

                <!-- Client Rows -->
                <tr
                  *ngFor="let client of filteredClients; let i = index"
                  class="hover:bg-gray-50 transition-colors duration-150"
                  [class.bg-blue-50]="i % 2 === 0"
                >
                  <!-- Client Info -->
                  <td class="px-6 py-4">
                    <div class="flex items-center">
                      <div
                        class="bg-gradient-to-br from-blue-400 to-blue-500 w-12 h-12 rounded-full flex items-center justify-center text-white mr-4 shadow-md"
                      >
                        <span class="text-lg font-bold"
                          >{{ client.fullName.charAt(0).toUpperCase() }}</span
                        >
                      </div>
                      <div>
                        <div class="text-lg font-semibold text-gray-800">
                          {{ client.fullName }}
                        </div>
                        <div class="text-sm text-gray-500">
                          ID: {{ client.uid.substring(0, 8) }}...
                        </div>
                      </div>
                    </div>
                  </td>

                  <!-- Contact Details -->
                  <td class="px-6 py-4">
                    <div class="space-y-2">
                      <div class="flex items-center text-gray-700">
                        <ion-icon
                          name="mail"
                          class="text-blue-500 mr-2 text-sm"
                        ></ion-icon>
                        <span class="text-sm">{{ client.email }}</span>
                      </div>
                      <div
                        class="flex items-center text-gray-700"
                        *ngIf="client.phone"
                      >
                        <ion-icon
                          name="call"
                          class="text-green-500 mr-2 text-sm"
                        ></ion-icon>
                        <span class="text-sm">{{ client.phone }}</span>
                      </div>
                      <div
                        class="flex items-center text-gray-500"
                        *ngIf="!client.phone"
                      >
                        <ion-icon
                          name="call-outline"
                          class="mr-2 text-sm"
                        ></ion-icon>
                        <span class="text-sm italic">No phone number</span>
                      </div>
                    </div>
                  </td>

                  <!-- Registration Date -->
                  <td class="px-6 py-4">
                    <div class="text-sm text-gray-700">
                      {{ client.createdAt | date:'MMM dd, yyyy' }}
                    </div>
                    <div class="text-xs text-gray-500">
                      {{ client.createdAt | date:'h:mm a' }}
                    </div>
                  </td>

                  <!-- Saved Locations -->
                  <td class="px-6 py-4">
                    <div
                      *ngIf="client.savedLocations && client.savedLocations.length > 0; else noLocations"
                    >
                      <div class="flex items-center">
                        <ion-icon
                          name="location"
                          class="text-red-500 mr-2 text-sm"
                        ></ion-icon>
                        <span class="text-sm text-gray-700"
                          >{{ client.savedLocations.length }} location(s)</span
                        >
                      </div>
                    </div>
                    <ng-template #noLocations>
                      <div class="flex items-center text-gray-500">
                        <ion-icon
                          name="location-outline"
                          class="mr-2 text-sm"
                        ></ion-icon>
                        <span class="text-sm italic">No saved locations</span>
                      </div>
                    </ng-template>
                  </td>

                  <!-- Actions -->
                  <td class="px-6 py-4">
                    <div class="flex items-center justify-center space-x-2">
                      <button
                        (click)="viewClientDetails(client)"
                        class="bg-blue-100 hover:bg-blue-200 text-blue-600 p-2 rounded-lg transition-colors"
                        title="View Details"
                      >
                        <ion-icon name="eye" class="text-lg"></ion-icon>
                      </button>
                      <button
                        (click)="sendMessageToClient(client)"
                        class="bg-green-100 hover:bg-green-200 text-green-600 p-2 rounded-lg transition-colors"
                        title="Send Message"
                      >
                        <ion-icon name="chatbubble" class="text-lg"></ion-icon>
                      </button>
                      <button
                        (click)="deleteClient(client)"
                        class="bg-red-100 hover:bg-red-200 text-red-600 p-2 rounded-lg transition-colors"
                        title="Delete Client"
                      >
                        <ion-icon name="trash" class="text-lg"></ion-icon>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Other Sections Placeholder -->
      <!-- <div
        *ngIf="activeSection !== 'dashboard' && activeSection !== 'workers' && activeSection !== 'services' && activeSection !== 'clients'"
        class="bg-white rounded-xl shadow-lg p-8 text-center"
      >
        <ion-icon
          name="construct"
          class="text-6xl text-gray-300 mb-4"
        ></ion-icon>
        <h3 class="text-xl font-semibold text-gray-600 mb-2">
          {{ getSectionTitle() }}
        </h3>
        <p class="text-gray-500">This section is under development.</p>
      </div> -->
    </main>
  </div>
</div>

<!-- Worker Details Modal -->
<ion-modal
  #workerDetailsModal
  [isOpen]="isWorkerModalOpen"
  (willDismiss)="closeWorkerModal()"
>
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-title>Worker Details</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="closeWorkerModal()">
            <ion-icon name="close"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>

    <ion-content class="ion-padding" *ngIf="selectedWorker">
      <div class="space-y-6">
        <!-- Personal Information -->
        <div class="bg-white rounded-lg border p-4">
          <h3
            class="text-lg font-semibold text-gray-800 mb-4 flex items-center"
          >
            <ion-icon name="person" class="mr-2 text-blue-500"></ion-icon>
            Personal Information
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="text-sm font-medium text-gray-500">Full Name</label>
              <p class="text-gray-900">{{ selectedWorker.fullName }}</p>
            </div>
            <div>
              <label class="text-sm font-medium text-gray-500">Email</label>
              <p class="text-gray-900">{{ selectedWorker.email }}</p>
            </div>
            <div>
              <label class="text-sm font-medium text-gray-500">Phone</label>
              <p class="text-gray-900">{{ selectedWorker.phone }}</p>
            </div>
            <div>
              <label class="text-sm font-medium text-gray-500">Status</label>
              <p class="text-gray-900">
                <span [class]="getStatusBadgeClass(selectedWorker.status)">
                  {{ selectedWorker.status | titlecase }}
                </span>
              </p>
            </div>
          </div>
        </div>

        <!-- Address Information -->
        <div class="bg-white rounded-lg border p-4">
          <h3
            class="text-lg font-semibold text-gray-800 mb-4 flex items-center"
          >
            <ion-icon name="location" class="mr-2 text-green-500"></ion-icon>
            Address Information
          </h3>
          <div>
            <label class="text-sm font-medium text-gray-500"
              >Full Address</label
            >
            <p class="text-gray-900">
              {{ selectedWorker.fullAddress || 'Not provided' }}
            </p>
          </div>
          <div class="mt-3" *ngIf="selectedWorker.workRadius">
            <label class="text-sm font-medium text-gray-500">Work Radius</label>
            <p class="text-gray-900">{{ selectedWorker.workRadius }} km</p>
          </div>
        </div>

        <!-- Skills and Availability -->
        <div class="bg-white rounded-lg border p-4">
          <h3
            class="text-lg font-semibold text-gray-800 mb-4 flex items-center"
          >
            <ion-icon name="build" class="mr-2 text-purple-500"></ion-icon>
            Skills & Availability
          </h3>
          <div class="mb-4">
            <label class="text-sm font-medium text-gray-500 mb-2 block"
              >Skills</label
            >
            <div class="flex flex-wrap gap-2">
              <span
                *ngFor="let skill of selectedWorker.skills"
                class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800"
              >
                {{ skill }}
              </span>
            </div>
          </div>
          <div
            *ngIf="selectedWorker.availableDays && selectedWorker.availableDays.length > 0"
          >
            <label class="text-sm font-medium text-gray-500 mb-2 block"
              >Available Days</label
            >
            <div class="flex flex-wrap gap-2">
              <span
                *ngFor="let day of selectedWorker.availableDays"
                class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800"
              >
                {{ day | titlecase }}
              </span>
            </div>
          </div>
        </div>

        <!-- Emergency Contact -->
        <div
          class="bg-white rounded-lg border p-4"
          *ngIf="selectedWorker.emergencyContact"
        >
          <h3
            class="text-lg font-semibold text-gray-800 mb-4 flex items-center"
          >
            <ion-icon name="call" class="mr-2 text-red-500"></ion-icon>
            Emergency Contact
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="text-sm font-medium text-gray-500"
                >Contact Name</label
              >
              <p class="text-gray-900">{{ selectedWorker.emergencyContact }}</p>
            </div>
            <div>
              <label class="text-sm font-medium text-gray-500"
                >Contact Phone</label
              >
              <p class="text-gray-900">{{ selectedWorker.emergencyPhone }}</p>
            </div>
          </div>
        </div>

        <!-- Identity Verification -->
        <div class="bg-white rounded-lg border p-4">
          <h3
            class="text-lg font-semibold text-gray-800 mb-4 flex items-center"
          >
            <ion-icon
              name="shield-checkmark"
              class="mr-2 text-yellow-500"
            ></ion-icon>
            Identity Verification
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- ID Photo -->
            <div class="text-center">
              <label class="text-sm font-medium text-gray-500 block mb-3"
                >Valid ID</label
              >
              <div class="relative group">
                <img
                  *ngIf="selectedWorker.idPhotoData"
                  [src]="selectedWorker.idPhotoData"
                  class="w-full h-40 object-cover rounded-lg border border-gray-200 cursor-pointer hover:opacity-80 transition-all duration-200 hover:scale-105"
                  (click)="openImageInNewTab(selectedWorker.idPhotoData, 'Valid ID - ' + selectedWorker.fullName)"
                  alt="Worker ID"
                  title="Click to view in new tab"
                />
                <!-- New Tab Indicator -->
                <div
                  class="absolute top-2 right-2 bg-blue-500 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-200"
                  *ngIf="selectedWorker.idPhotoData"
                >
                  <ion-icon name="open-outline" class="text-xs"></ion-icon>
                </div>
                <div
                  *ngIf="!selectedWorker.idPhotoData"
                  class="w-full h-40 bg-gray-100 rounded-lg border border-gray-200 flex items-center justify-center"
                >
                  <div class="text-center">
                    <ion-icon
                      name="image-outline"
                      class="text-gray-400 text-3xl mb-2"
                    ></ion-icon>
                    <p class="text-gray-500 text-sm">No ID photo provided</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Profile Photo -->
            <div class="text-center">
              <label class="text-sm font-medium text-gray-500 block mb-3"
                >Profile Photo</label
              >
              <div class="relative group">
                <img
                  *ngIf="selectedWorker.profilePhotoData"
                  [src]="selectedWorker.profilePhotoData"
                  class="w-full h-40 object-cover rounded-lg border border-gray-200 cursor-pointer hover:opacity-80 transition-all duration-200 hover:scale-105"
                  (click)="openImageInNewTab(selectedWorker.profilePhotoData, 'Profile Photo - ' + selectedWorker.fullName)"
                  alt="Worker Profile"
                  title="Click to view in new tab"
                />
                <!-- New Tab Indicator -->
                <div
                  class="absolute top-2 right-2 bg-blue-500 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-200"
                  *ngIf="selectedWorker.profilePhotoData"
                >
                  <ion-icon name="open-outline" class="text-xs"></ion-icon>
                </div>
                <div
                  *ngIf="!selectedWorker.profilePhotoData"
                  class="w-full h-40 bg-gray-100 rounded-lg border border-gray-200 flex items-center justify-center"
                >
                  <div class="text-center">
                    <ion-icon
                      name="person-outline"
                      class="text-gray-400 text-3xl mb-2"
                    ></ion-icon>
                    <p class="text-gray-500 text-sm">
                      No profile photo provided
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Professional Certificates -->
        <div
          class="bg-white rounded-lg border p-4"
          *ngIf="selectedWorker.certificates && getWorkerCertificateKeys(selectedWorker.certificates).length > 0"
        >
          <h3
            class="text-lg font-semibold text-gray-800 mb-4 flex items-center"
          >
            <ion-icon name="ribbon" class="mr-2 text-indigo-500"></ion-icon>
            Professional Certificates
          </h3>
          <div class="space-y-4">
            <div
              *ngFor="let skill of getWorkerCertificateKeys(selectedWorker.certificates)"
              class="border border-gray-200 rounded-lg p-4"
            >
              <div class="flex items-start justify-between mb-3">
                <div class="flex items-center space-x-3">
                  <div class="bg-indigo-100 p-2 rounded-lg">
                    <ion-icon
                      name="document-text"
                      class="text-indigo-600"
                    ></ion-icon>
                  </div>
                  <div>
                    <h4 class="font-semibold text-gray-800">{{ skill }}</h4>
                    <p class="text-sm text-gray-500">
                      Professional Certificate
                    </p>
                  </div>
                </div>
                <span
                  class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"
                >
                  <ion-icon
                    name="checkmark-circle"
                    class="mr-1 text-xs"
                  ></ion-icon>
                  Uploaded
                </span>
              </div>

              <!-- Certificate Preview -->
              <div class="relative">
                <div
                  class="bg-gray-50 rounded-lg border-2 border-dashed border-gray-300 p-4 text-center"
                >
                  <div
                    *ngIf="isCertificateImage(selectedWorker.certificates![skill]); else pdfCertificate"
                    class="relative group"
                  >
                    <img
                      [src]="selectedWorker.certificates![skill]"
                      class="max-w-full h-40 object-contain mx-auto rounded cursor-pointer hover:opacity-80 transition-all duration-200 hover:scale-105"
                      (click)="openImageInNewTab(selectedWorker.certificates![skill], skill + ' Certificate - ' + selectedWorker.fullName)"
                      [alt]="skill + ' Certificate'"
                      title="Click to view in new tab"
                    />
                    <!-- New Tab Indicator -->
                    <div
                      class="absolute top-2 right-2 bg-blue-500 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-200"
                    >
                      <ion-icon name="open-outline" class="text-xs"></ion-icon>
                    </div>
                    <p class="text-sm text-gray-600 mt-2">
                      Click to view in new tab
                    </p>
                  </div>
                  <ng-template #pdfCertificate>
                    <div class="flex items-center justify-center py-8">
                      <div class="text-center">
                        <ion-icon
                          name="document"
                          class="text-red-500 text-4xl mb-2"
                        ></ion-icon>
                        <p class="text-gray-700 font-medium">PDF Certificate</p>
                        <p class="text-sm text-gray-500 mb-3">
                          {{ skill }} Certification Document
                        </p>
                        <button
                          (click)="downloadCertificate(selectedWorker.certificates![skill], skill)"
                          class="inline-flex items-center px-3 py-2 bg-blue-500 text-white text-sm rounded-lg hover:bg-blue-600 transition-colors"
                        >
                          <ion-icon name="download" class="mr-2"></ion-icon>
                          Download PDF
                        </button>
                      </div>
                    </div>
                  </ng-template>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- No Certificates Message -->
        <div
          class="bg-white rounded-lg border p-4"
          *ngIf="!selectedWorker.certificates || getWorkerCertificateKeys(selectedWorker.certificates).length === 0"
        >
          <h3
            class="text-lg font-semibold text-gray-800 mb-4 flex items-center"
          >
            <ion-icon name="ribbon" class="mr-2 text-indigo-500"></ion-icon>
            Professional Certificates
          </h3>
          <div class="text-center py-8">
            <ion-icon
              name="document-text-outline"
              class="text-gray-400 text-4xl mb-3"
            ></ion-icon>
            <h4 class="text-gray-600 font-medium mb-2">
              No Certificates Uploaded
            </h4>
            <p class="text-gray-500 text-sm">
              This worker has not uploaded any professional certificates yet.
            </p>
          </div>
        </div>

        <!-- Action Buttons (only for pending workers) -->
        <div
          class="bg-white rounded-lg border p-4"
          *ngIf="selectedWorker.status === 'pending_verification'"
        >
          <h3 class="text-lg font-semibold text-gray-800 mb-4">Actions</h3>
          <div class="flex space-x-4">
            <button
              (click)="approveWorkerFromModal(selectedWorker)"
              [disabled]="processingWorker === selectedWorker.uid"
              class="flex-1 bg-green-500 hover:bg-green-600 disabled:bg-gray-400 text-white px-4 py-2 rounded-lg transition-colors flex items-center justify-center"
            >
              <ion-icon name="checkmark" class="mr-2"></ion-icon>
              {{ processingWorker === selectedWorker.uid ? 'Processing...' :
              'Approve Worker' }}
            </button>
            <button
              (click)="rejectWorkerFromModal(selectedWorker)"
              [disabled]="processingWorker === selectedWorker.uid"
              class="flex-1 bg-red-500 hover:bg-red-600 disabled:bg-gray-400 text-white px-4 py-2 rounded-lg transition-colors flex items-center justify-center"
            >
              <ion-icon name="close" class="mr-2"></ion-icon>
              {{ processingWorker === selectedWorker.uid ? 'Processing...' :
              'Reject Worker' }}
            </button>
          </div>
        </div>
      </div>
    </ion-content>
  </ng-template>
</ion-modal>

<!-- Enhanced Service Management Modal -->
<ion-modal
  #serviceModal
  [isOpen]="isServiceModalOpen"
  (willDismiss)="closeServiceModal()"
  class="custom-modal large-modal"
>
  <ng-template>
    <ion-header class="ion-no-border">
      <ion-toolbar class="custom-toolbar">
        <div
          class="flex items-center justify-between p-6 bg-gradient-to-r from-red-50 to-orange-50 border-b border-gray-200"
        >
          <div class="flex items-center">
            <div
              class="bg-gradient-to-br from-red-500 to-red-600 w-12 h-12 rounded-xl flex items-center justify-center text-white mr-4 shadow-lg"
            >
              <ion-icon
                [name]="isEditingService ? 'pencil' : 'add'"
                class="text-xl"
              ></ion-icon>
            </div>
            <div>
              <h2 class="text-2xl font-bold text-gray-800">
                {{ isEditingService ? 'Edit Service' : 'Create New Service' }}
              </h2>
              <p class="text-gray-600 text-sm">
                {{ isEditingService ? 'Update service information and settings'
                : 'Add a new service category to your platform' }}
              </p>
            </div>
          </div>
          <button
            (click)="closeServiceModal()"
            class="p-3 text-gray-500 hover:text-gray-700 hover:bg-white/50 rounded-xl transition-all duration-200"
          >
            <ion-icon name="close" class="text-2xl"></ion-icon>
          </button>
        </div>
      </ion-toolbar>
    </ion-header>

    <ion-content class="custom-modal-content">
      <div class="max-w-none mx-auto p-6 lg:p-8 xl:p-10 h-full">
        <form
          [formGroup]="serviceForm"
          (ngSubmit)="saveService()"
          class="h-full flex flex-col"
        >
          <!-- Main Content Area with Two Columns -->
          <div
            class="flex-1 grid grid-cols-1 lg:grid-cols-2 gap-6 lg:gap-8 xl:gap-10 mb-8"
          >
            <!-- Left Column -->
            <div class="space-y-8">
              <!-- Basic Information -->
              <div
                class="bg-gradient-to-br from-white to-gray-50 rounded-2xl border border-gray-200 p-8 shadow-sm"
              >
                <div class="flex items-center mb-6">
                  <div class="bg-blue-100 p-3 rounded-xl mr-4">
                    <ion-icon
                      name="information-circle"
                      class="text-blue-600 text-2xl"
                    ></ion-icon>
                  </div>
                  <div>
                    <h3 class="text-xl font-bold text-gray-800">
                      Basic Information
                    </h3>
                    <p class="text-sm text-gray-600">
                      Define the core details of your service
                    </p>
                  </div>
                </div>

                <div class="space-y-6">
                  <!-- Service Name -->
                  <div class="space-y-3">
                    <label
                      class="flex items-center text-sm font-semibold text-gray-700 mb-4"
                    >
                      <ion-icon
                        name="text"
                        class="mr-2 text-blue-500"
                      ></ion-icon>
                      Service Name *
                    </label>
                    <div class="relative">
                      <input
                        type="text"
                        formControlName="name"
                        placeholder="e.g., Electrical Services"
                        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-red-500/20 focus:border-red-500 transition-all duration-200 bg-white shadow-sm"
                        [class.border-red-500]="serviceForm.get('name')?.invalid && serviceForm.get('name')?.touched"
                        [class.bg-red-50]="serviceForm.get('name')?.invalid && serviceForm.get('name')?.touched"
                      />
                      <div
                        class="absolute inset-y-0 right-0 flex items-center pr-3"
                      >
                        <ion-icon
                          [name]="serviceForm.get('name')?.valid ? 'checkmark-circle' : 'alert-circle'"
                          [class]="serviceForm.get('name')?.valid ? 'text-green-500' : 'text-gray-300'"
                          class="text-lg"
                        ></ion-icon>
                      </div>
                    </div>
                    <div
                      *ngIf="serviceForm.get('name')?.invalid && serviceForm.get('name')?.touched"
                      class="flex items-center text-red-600 text-sm mt-2 bg-red-50 p-2 rounded-lg"
                    >
                      <ion-icon name="warning" class="mr-2"></ion-icon>
                      Service name is required (minimum 2 characters)
                    </div>
                  </div>

                  <!-- Service Description -->
                  <div class="space-y-3">
                    <label
                      class="flex items-center text-sm font-semibold text-gray-700 mb-4"
                    >
                      <ion-icon
                        name="document-text"
                        class="mr-2 text-indigo-500"
                      ></ion-icon>
                      Service Description *
                    </label>
                    <div class="relative">
                      <textarea
                        formControlName="description"
                        rows="5"
                        placeholder="Provide a detailed description of this service category. Explain what services are included, typical duration, and any special features customers should know about..."
                        class="w-full px-5 py-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all duration-200 bg-white shadow-sm resize-none text-base"
                        [class.border-red-500]="serviceForm.get('description')?.invalid && serviceForm.get('description')?.touched"
                        [class.bg-red-50]="serviceForm.get('description')?.invalid && serviceForm.get('description')?.touched"
                      ></textarea>
                      <div
                        class="absolute bottom-3 right-3 text-xs text-gray-400"
                      >
                        {{ serviceForm.get('description')?.value?.length || 0 }}
                        / 500 characters
                      </div>
                    </div>
                    <div
                      *ngIf="serviceForm.get('description')?.invalid && serviceForm.get('description')?.touched"
                      class="flex items-center text-red-600 text-sm mt-2 bg-red-50 p-3 rounded-lg"
                    >
                      <ion-icon name="warning" class="mr-2"></ion-icon>
                      Description is required (minimum 10 characters)
                    </div>
                    <div
                      *ngIf="serviceForm.get('description')?.valid"
                      class="flex items-center text-green-600 text-sm mt-2 bg-green-50 p-3 rounded-lg"
                    >
                      <ion-icon name="checkmark-circle" class="mr-2"></ion-icon>
                      Great! Your description looks good
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Right Column -->
            <div class="space-y-8">
              <!-- Icon & Color Settings -->
              <div
                class="bg-gradient-to-br from-white to-purple-50 rounded-2xl border border-gray-200 p-8 shadow-sm"
              >
                <div class="flex items-center mb-6">
                  <div class="bg-purple-100 p-3 rounded-xl mr-4">
                    <ion-icon
                      name="color-palette"
                      class="text-purple-600 text-2xl"
                    ></ion-icon>
                  </div>
                  <div>
                    <h3 class="text-xl font-bold text-gray-800">
                      Visual Identity
                    </h3>
                    <p class="text-sm text-gray-600">
                      Choose icon and brand color for your service
                    </p>
                  </div>
                </div>

                <div class="space-y-6">
                  <!-- Service Icon -->
                  <div class="space-y-3">
                    <label
                      class="flex items-center text-sm font-semibold text-gray-700 mb-4"
                    >
                      <ion-icon
                        name="shapes"
                        class="mr-2 text-purple-500"
                      ></ion-icon>
                      Service Icon *
                    </label>

                    <!-- Hidden Icon Input for Form Control -->
                    <input type="hidden" formControlName="icon" />

                    <!-- Enhanced Selected Icon Display -->
                    <div
                      class="mb-4 p-4 border-2 border-dashed border-gray-200 rounded-xl bg-gradient-to-br from-gray-50 to-white hover:border-purple-300 transition-all duration-200"
                    >
                      <div class="flex items-center justify-between">
                        <div class="flex items-center">
                          <div class="relative mr-4">
                            <div
                              [style.background]="'linear-gradient(135deg, ' + (serviceForm.get('color')?.value || '#3B82F6') + ', ' + (serviceForm.get('color')?.value || '#3B82F6') + 'cc)'"
                              class="w-14 h-14 rounded-xl flex items-center justify-center text-white shadow-lg"
                            >
                              <ion-icon
                                [name]="serviceForm.get('icon')?.value || 'help-outline'"
                                class="text-2xl"
                              ></ion-icon>
                            </div>
                            <div
                              class="absolute -bottom-1 -right-1 w-6 h-6 bg-white rounded-full border-2 border-gray-200 flex items-center justify-center shadow-sm"
                            >
                              <ion-icon
                                [name]="serviceForm.get('icon')?.value ? 'checkmark' : 'help'"
                                [class]="serviceForm.get('icon')?.value ? 'text-green-500' : 'text-gray-400'"
                                class="text-sm"
                              ></ion-icon>
                            </div>
                          </div>
                          <div>
                            <p class="font-semibold text-gray-800 text-lg">
                              {{ serviceForm.get('icon')?.value || 'No icon
                              selected' }}
                            </p>
                            <p class="text-sm text-gray-500 flex items-center">
                              <ion-icon
                                name="color-palette"
                                class="mr-1"
                              ></ion-icon>
                              {{ serviceForm.get('icon')?.value ? 'Perfect! Icon
                              selected' : 'Choose an icon to represent your
                              service' }}
                            </p>
                          </div>
                        </div>
                        <button
                          type="button"
                          (click)="showIconPicker = !showIconPicker"
                          class="bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white px-6 py-3 rounded-xl text-sm font-medium transition-all duration-200 transform hover:scale-105 shadow-lg flex items-center"
                        >
                          <ion-icon
                            [name]="showIconPicker ? 'eye-off' : 'eye'"
                            class="mr-2"
                          ></ion-icon>
                          {{ showIconPicker ? 'Hide Picker' : 'Choose Icon' }}
                        </button>
                      </div>
                    </div>

                    <!-- Enhanced Icon Picker Grid -->
                    <div
                      *ngIf="showIconPicker"
                      class="border-2 border-purple-200 rounded-2xl p-8 bg-gradient-to-br from-white to-purple-50 max-h-[500px] overflow-y-auto shadow-inner"
                    >
                      <!-- Search Input -->
                      <div class="mb-6">
                        <div class="relative">
                          <input
                            type="text"
                            [(ngModel)]="iconSearchTerm"
                            [ngModelOptions]="{standalone: true}"
                            (ngModelChange)="filterIcons()"
                            placeholder="Search for the perfect icon..."
                            class="w-full px-4 py-3 pl-12 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-purple-500/20 focus:border-purple-500 transition-all duration-200 bg-white shadow-sm"
                          />
                          <div
                            class="absolute inset-y-0 left-0 flex items-center pl-4"
                          >
                            <ion-icon
                              name="search"
                              class="text-gray-400 text-lg"
                            ></ion-icon>
                          </div>
                        </div>
                      </div>

                      <!-- Category Tabs -->
                      <div *ngIf="!iconSearchTerm.trim()" class="mb-6">
                        <p
                          class="text-sm font-semibold text-gray-700 mb-3 flex items-center"
                        >
                          <ion-icon
                            name="albums"
                            class="mr-2 text-purple-500"
                          ></ion-icon>
                          Categories
                        </p>
                        <div class="flex flex-wrap gap-2">
                          <button
                            *ngFor="let category of iconCategories"
                            type="button"
                            (click)="selectIconCategory(category.key)"
                            [class]="selectedIconCategory === category.key 
                          ? 'bg-gradient-to-r from-purple-500 to-purple-600 text-white shadow-lg' 
                          : 'bg-white hover:bg-purple-50 text-gray-700 border border-gray-200 hover:border-purple-300'"
                            class="px-4 py-2 rounded-xl text-sm font-medium transition-all duration-200 transform hover:scale-105"
                          >
                            {{ category.name }}
                          </button>
                        </div>
                      </div>

                      <!-- Icon Grid -->
                      <div class="grid grid-cols-10 lg:grid-cols-12 gap-3 mb-6">
                        <button
                          *ngFor="let icon of filteredIcons"
                          type="button"
                          (click)="selectIcon(icon)"
                          [class]="serviceForm.get('icon')?.value === icon 
                        ? 'bg-gradient-to-br from-purple-500 to-purple-600 text-white shadow-lg transform scale-110' 
                        : 'bg-white hover:bg-purple-50 text-gray-700 border border-gray-200 hover:border-purple-300 hover:shadow-md'"
                          class="w-12 h-12 rounded-xl flex items-center justify-center transition-all duration-200 transform hover:scale-105"
                          [title]="icon"
                        >
                          <ion-icon [name]="icon" class="text-xl"></ion-icon>
                        </button>
                      </div>

                      <!-- No Results State -->
                      <div
                        *ngIf="filteredIcons.length === 0"
                        class="text-center py-8"
                      >
                        <div
                          class="bg-gray-100 w-16 h-16 rounded-2xl flex items-center justify-center mx-auto mb-4"
                        >
                          <ion-icon
                            name="search-outline"
                            class="text-gray-400 text-3xl"
                          ></ion-icon>
                        </div>
                        <h4 class="font-semibold text-gray-700 mb-2">
                          No icons found
                        </h4>
                        <p class="text-gray-500 text-sm">
                          Try searching with different keywords
                        </p>
                      </div>

                      <!-- Popular Icons Section -->
                      <div
                        *ngIf="!iconSearchTerm.trim() && selectedIconCategory === 'all'"
                        class="pt-6 border-t border-purple-200"
                      >
                        <p
                          class="text-sm font-semibold text-gray-700 mb-4 flex items-center"
                        >
                          <ion-icon
                            name="star"
                            class="mr-2 text-yellow-500"
                          ></ion-icon>
                          Popular Service Icons
                        </p>
                        <div class="flex flex-wrap gap-2">
                          <button
                            *ngFor="let icon of popularIcons"
                            type="button"
                            (click)="selectIcon(icon)"
                            [class]="serviceForm.get('icon')?.value === icon 
                          ? 'bg-gradient-to-br from-yellow-400 to-yellow-500 text-white shadow-lg' 
                          : 'bg-gradient-to-br from-yellow-50 to-yellow-100 hover:from-yellow-100 hover:to-yellow-200 text-yellow-700 border border-yellow-200'"
                            class="w-10 h-10 rounded-lg flex items-center justify-center transition-all duration-200 transform hover:scale-105"
                            [title]="icon"
                          >
                            <ion-icon [name]="icon" class="text-lg"></ion-icon>
                          </button>
                        </div>
                      </div>
                    </div>

                    <div
                      *ngIf="serviceForm.get('icon')?.invalid && serviceForm.get('icon')?.touched"
                      class="text-red-500 text-sm mt-1"
                    >
                      Icon is required
                    </div>
                  </div>

                  <!-- Brand Color -->
                  <div class="space-y-3">
                    <label
                      class="flex items-center text-sm font-semibold text-gray-700 mb-4"
                    >
                      <ion-icon
                        name="color-palette"
                        class="mr-2 text-pink-500"
                      ></ion-icon>
                      Brand Color *
                    </label>
                    <div
                      class="bg-white border-2 border-gray-200 rounded-xl p-6 space-y-4"
                    >
                      <div class="flex items-center space-x-4">
                        <div class="relative">
                          <input
                            type="color"
                            formControlName="color"
                            class="w-16 h-16 border-2 border-gray-200 rounded-xl cursor-pointer shadow-sm hover:shadow-md transition-shadow"
                          />
                          <div
                            class="absolute -top-1 -right-1 w-6 h-6 bg-white rounded-full border-2 border-gray-200 flex items-center justify-center shadow-sm"
                          >
                            <ion-icon
                              name="eyedrop"
                              class="text-gray-500 text-xs"
                            ></ion-icon>
                          </div>
                        </div>
                        <div class="flex-1">
                          <input
                            type="text"
                            formControlName="color"
                            placeholder="#3B82F6"
                            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-pink-500/20 focus:border-pink-500 transition-all duration-200 bg-gray-50 font-mono text-sm"
                          />
                          <p
                            class="text-xs text-gray-500 mt-2 flex items-center"
                          >
                            <ion-icon
                              name="information-circle"
                              class="mr-1"
                            ></ion-icon>
                            This color will represent your service across the
                            platform
                          </p>
                        </div>
                      </div>
                      <!-- Color Preview -->
                      <div
                        class="flex items-center justify-center p-3 rounded-lg"
                        [style.background]="'linear-gradient(135deg, ' + (serviceForm.get('color')?.value || '#3B82F6') + ', ' + (serviceForm.get('color')?.value || '#3B82F6') + 'cc)'"
                      >
                        <span class="text-white font-medium text-sm"
                          >{{ serviceForm.get('name')?.value || 'Service
                          Preview' }}</span
                        >
                      </div>
                    </div>
                  </div>

                  <!-- Service Status -->
                  <div class="space-y-3">
                    <label
                      class="flex items-center text-sm font-semibold text-gray-700 mb-4"
                    >
                      <ion-icon
                        name="toggle"
                        class="mr-2 text-green-500"
                      ></ion-icon>
                      Service Status
                    </label>
                    <div
                      class="bg-white border-2 border-gray-200 rounded-xl p-6"
                    >
                      <div class="flex items-center justify-between">
                        <div class="flex items-center">
                          <div class="relative">
                            <input
                              type="checkbox"
                              formControlName="isActive"
                              class="sr-only"
                              id="serviceStatus"
                            />
                            <label
                              for="serviceStatus"
                              class="flex items-center cursor-pointer"
                            >
                              <div
                                [class]="serviceForm.get('isActive')?.value 
                                ? 'bg-green-500 border-green-500' 
                                : 'bg-gray-200 border-gray-300'"
                                class="relative w-12 h-6 border-2 rounded-full transition-all duration-200"
                              >
                                <div
                                  [class]="serviceForm.get('isActive')?.value 
                                  ? 'translate-x-6 bg-white' 
                                  : 'translate-x-0 bg-gray-400'"
                                  class="absolute top-0 left-0 w-5 h-5 rounded-full shadow-sm transition-transform duration-200"
                                ></div>
                              </div>
                              <span
                                class="ml-3 font-medium"
                                [class]="serviceForm.get('isActive')?.value ? 'text-green-700' : 'text-gray-600'"
                              >
                                {{ serviceForm.get('isActive')?.value ? 'Active'
                                : 'Inactive' }}
                              </span>
                            </label>
                          </div>
                        </div>
                        <div
                          [class]="serviceForm.get('isActive')?.value 
                          ? 'bg-green-100 text-green-800 border-green-200' 
                          : 'bg-gray-100 text-gray-600 border-gray-200'"
                          class="px-3 py-1 rounded-full text-xs font-semibold border"
                        >
                          {{ serviceForm.get('isActive')?.value ? 'Available to
                          customers' : 'Hidden from customers' }}
                        </div>
                      </div>
                      <p class="text-xs text-gray-500 mt-3 flex items-center">
                        <ion-icon
                          name="information-circle"
                          class="mr-1"
                        ></ion-icon>
                        {{ serviceForm.get('isActive')?.value ? 'Service is
                        visible and bookable by customers' : 'Service is hidden
                        and not available for booking' }}
                      </p>
                    </div>
                  </div>

                  <!-- Certificate Requirement -->
                  <div class="space-y-3">
                    <label
                      class="flex items-center text-sm font-semibold text-gray-700 mb-4"
                    >
                      <ion-icon
                        name="document"
                        class="mr-2 text-orange-500"
                      ></ion-icon>
                      Certificate Requirement
                    </label>
                    <div
                      class="bg-white border-2 border-gray-200 rounded-xl p-6"
                    >
                      <div class="flex items-center justify-between">
                        <div class="flex items-center">
                          <div class="relative">
                            <input
                              type="checkbox"
                              formControlName="requiresCertificate"
                              class="sr-only"
                              id="certificateRequired"
                            />
                            <label
                              for="certificateRequired"
                              class="flex items-center cursor-pointer"
                            >
                              <div
                                [class]="serviceForm.get('requiresCertificate')?.value 
                                ? 'bg-orange-500 border-orange-500' 
                                : 'bg-gray-200 border-gray-300'"
                                class="relative w-12 h-6 border-2 rounded-full transition-all duration-200"
                              >
                                <div
                                  [class]="serviceForm.get('requiresCertificate')?.value 
                                  ? 'translate-x-6 bg-white' 
                                  : 'translate-x-0 bg-gray-400'"
                                  class="absolute top-0 left-0 w-5 h-5 rounded-full shadow-sm transition-transform duration-200"
                                ></div>
                              </div>
                              <span
                                class="ml-3 font-medium"
                                [class]="serviceForm.get('requiresCertificate')?.value ? 'text-orange-700' : 'text-gray-600'"
                              >
                                {{ serviceForm.get('requiresCertificate')?.value
                                ? 'Required' : 'Not Required' }}
                              </span>
                            </label>
                          </div>
                        </div>
                        <div
                          [class]="serviceForm.get('requiresCertificate')?.value 
                          ? 'bg-orange-100 text-orange-800 border-orange-200' 
                          : 'bg-gray-100 text-gray-600 border-gray-200'"
                          class="px-3 py-1 rounded-full text-xs font-semibold border"
                        >
                          {{ serviceForm.get('requiresCertificate')?.value ?
                          'Certificate mandatory for workers' : 'No certificate
                          needed' }}
                        </div>
                      </div>
                      <p class="text-xs text-gray-500 mt-3 flex items-center">
                        <ion-icon
                          name="information-circle"
                          class="mr-1"
                        ></ion-icon>
                        {{ serviceForm.get('requiresCertificate')?.value ?
                        'Workers must upload a valid certificate during
                        interview process' : 'Workers can apply without any
                        certificate for this service' }}
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Sub-services and Requirements -->
            <div class="space-y-6">
              <!-- Sub-services -->
              <div
                class="bg-gradient-to-br from-white to-blue-50 rounded-2xl border border-gray-200 p-6 shadow-sm"
              >
                <div class="flex items-center mb-4">
                  <div class="bg-blue-100 p-2 rounded-lg mr-3">
                    <ion-icon
                      name="list"
                      class="text-blue-600 text-lg"
                    ></ion-icon>
                  </div>
                  <div class="flex-1">
                    <h4 class="text-lg font-bold text-gray-800">
                      Sub-services
                    </h4>
                    <p class="text-xs text-gray-600">
                      Define specific services within this category
                    </p>
                  </div>
                  <button
                    type="button"
                    (click)="addSubService()"
                    class="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-4 py-2 rounded-lg text-xs font-medium transition-all duration-200 transform hover:scale-105 shadow-md flex items-center"
                  >
                    <ion-icon name="add-circle" class="mr-1 text-sm"></ion-icon>
                    Add
                  </button>
                </div>

                <div class="space-y-3 max-h-48 overflow-y-auto">
                  <div
                    *ngFor="let subService of subServices; let i = index"
                    class="bg-white border border-gray-200 p-4 rounded-lg shadow-sm hover:shadow-md transition-all duration-200"
                  >
                    <div class="flex items-center space-x-3 mb-3">
                      <div class="bg-blue-100 p-1 rounded">
                        <ion-icon
                          name="chevron-forward"
                          class="text-blue-600 text-xs"
                        ></ion-icon>
                      </div>
                      <input
                        type="text"
                        [(ngModel)]="subServices[i]"
                        [ngModelOptions]="{standalone: true}"
                        placeholder="e.g., Socket Installation"
                        class="flex-1 px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-200 bg-gray-50 focus:bg-white text-sm"
                      />
                      <button
                        type="button"
                        (click)="removeSubService(i)"
                        class="text-red-600 hover:bg-red-100 p-2 rounded-lg transition-all duration-200"
                        title="Remove sub-service"
                      >
                        <ion-icon
                          name="trash-outline"
                          class="text-sm"
                        ></ion-icon>
                      </button>
                    </div>

                    <!-- Unit Pricing Dropdown -->
                    <div class="flex items-center space-x-3 ml-8 mb-3">
                      <div class="bg-green-100 p-1 rounded">
                        <ion-icon
                          name="time-outline"
                          class="text-green-600 text-xs"
                        ></ion-icon>
                      </div>
                      <label
                        class="text-sm font-medium text-gray-700 min-w-0 flex-shrink-0"
                      >
                        Unit Pricing:
                      </label>
                      <select
                        [(ngModel)]="servicesPricing[i]"
                        [ngModelOptions]="{standalone: true}"
                        (ngModelChange)="updateServicePricing(i, $event)"
                        class="flex-1 px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-green-500/20 focus:border-green-500 transition-all duration-200 bg-gray-50 focus:bg-white text-sm"
                      >
                        <option value="per_hour">Per Hour</option>
                        <option value="per_day">Per Day</option>
                      </select>
                    </div>

                    <!-- Quick Booking Pricing Input -->
                    <div class="flex items-center space-x-3 ml-8">
                      <div class="bg-purple-100 p-1 rounded">
                        <ion-icon
                          name="flash-outline"
                          class="text-purple-600 text-xs"
                        ></ion-icon>
                      </div>
                      <label
                        class="text-sm font-medium text-gray-700 min-w-0 flex-shrink-0"
                      >
                        Quick Booking:
                      </label>
                      <div class="flex-1 flex space-x-2">
                        <div class="relative flex-1">
                          <span
                            class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 text-sm"
                            >â‚±</span
                          >
                          <input
                            type="number"
                            [(ngModel)]="servicesQuickBookingPricing[i]"
                            [ngModelOptions]="{standalone: true}"
                            (ngModelChange)="updateQuickBookingPricing(i, $event)"
                            placeholder="0.00"
                            min="0"
                            step="0.01"
                            class="w-full pl-8 pr-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500/20 focus:border-purple-500 transition-all duration-200 bg-gray-50 focus:bg-white text-sm"
                          />
                        </div>
                        <select
                          [(ngModel)]="servicesQuickBookingUnit[i]"
                          [ngModelOptions]="{standalone: true}"
                          (ngModelChange)="updateQuickBookingUnit(i, $event)"
                          class="px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500/20 focus:border-purple-500 transition-all duration-200 bg-gray-50 focus:bg-white text-sm min-w-0 flex-shrink-0"
                        >
                          <option value="per_hour">Per Hour</option>
                          <option value="per_day">Per Day</option>
                        </select>
                      </div>
                    </div>
                  </div>

                  <div
                    *ngIf="subServices.length === 0"
                    class="text-center py-6 text-gray-500"
                  >
                    <ion-icon
                      name="list-outline"
                      class="text-2xl mb-2"
                    ></ion-icon>
                    <p class="text-sm">No sub-services added yet</p>
                  </div>
                </div>
              </div>

              <!-- Requirements -->
              <div
                class="bg-gradient-to-br from-white to-amber-50 rounded-2xl border border-gray-200 p-6 shadow-sm"
              >
                <div class="flex items-center mb-4">
                  <div class="bg-amber-100 p-2 rounded-lg mr-3">
                    <ion-icon
                      name="shield-checkmark"
                      class="text-amber-600 text-lg"
                    ></ion-icon>
                  </div>
                  <div class="flex-1">
                    <h4 class="text-lg font-bold text-gray-800">
                      Requirements
                    </h4>
                    <p class="text-xs text-gray-600">
                      Set prerequisites for service providers
                    </p>
                  </div>
                  <button
                    type="button"
                    (click)="addRequirement()"
                    class="bg-gradient-to-r from-amber-500 to-amber-600 hover:from-amber-600 hover:to-amber-700 text-white px-4 py-2 rounded-lg text-xs font-medium transition-all duration-200 transform hover:scale-105 shadow-md flex items-center"
                  >
                    <ion-icon name="add-circle" class="mr-1 text-sm"></ion-icon>
                    Add
                  </button>
                </div>

                <div class="space-y-3 max-h-48 overflow-y-auto">
                  <div
                    *ngFor="let requirement of requirements; let i = index"
                    class="flex items-center space-x-3 bg-white border border-gray-200 p-3 rounded-lg shadow-sm hover:shadow-md transition-all duration-200"
                  >
                    <div class="bg-amber-100 p-1 rounded">
                      <ion-icon
                        name="shield-checkmark"
                        class="text-amber-600 text-xs"
                      ></ion-icon>
                    </div>
                    <input
                      type="text"
                      [(ngModel)]="requirements[i]"
                      [ngModelOptions]="{standalone: true}"
                      placeholder="e.g., Licensed Professional"
                      class="flex-1 px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-amber-500/20 focus:border-amber-500 transition-all duration-200 bg-gray-50 focus:bg-white text-sm"
                    />
                    <button
                      type="button"
                      (click)="removeRequirement(i)"
                      class="text-red-600 hover:bg-red-100 p-2 rounded-lg transition-all duration-200"
                      title="Remove requirement"
                    >
                      <ion-icon name="trash-outline" class="text-sm"></ion-icon>
                    </button>
                  </div>

                  <div
                    *ngIf="requirements.length === 0"
                    class="text-center py-6 text-gray-500"
                  >
                    <ion-icon
                      name="shield-checkmark-outline"
                      class="text-2xl mb-2"
                    ></ion-icon>
                    <p class="text-sm">No requirements specified</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Enhanced Modal Footer -->
          <div
            class="sticky bottom-0 bg-white border-t border-gray-200 px-8 py-6 rounded-b-2xl z-10"
          >
            <div class="flex items-center justify-between">
              <!-- Progress Indicator -->
              <div class="flex items-center space-x-3">
                <div class="flex space-x-1">
                  <div
                    *ngFor="let step of ['basic', 'pricing', 'visual', 'details']; let i = index"
                    class="w-2 h-2 rounded-full transition-all duration-300"
                    [class]="i <= 2 ? 'bg-indigo-500' : 'bg-gray-300'"
                  ></div>
                </div>
                <span class="text-sm text-gray-600 font-medium"
                  >All sections completed</span
                >
              </div>

              <!-- Action Buttons -->
              <div class="flex items-center space-x-4">
                <!-- Save as Draft -->
                <button
                  type="button"
                  class="px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-xl font-semibold hover:bg-gray-50 hover:border-gray-400 transition-all duration-200 flex items-center shadow-sm"
                >
                  <ion-icon name="bookmark-outline" class="mr-2"></ion-icon>
                  Save Draft
                </button>

                <!-- Preview -->
                <button
                  type="button"
                  class="px-6 py-3 bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white rounded-xl font-semibold transition-all duration-200 transform hover:scale-105 shadow-lg flex items-center"
                >
                  <ion-icon name="eye-outline" class="mr-2"></ion-icon>
                  Preview
                </button>

                <!-- Cancel -->
                <button
                  type="button"
                  (click)="closeServiceModal()"
                  class="px-6 py-3 border-2 border-red-300 text-red-600 rounded-xl font-semibold hover:bg-red-50 hover:border-red-400 transition-all duration-200 flex items-center shadow-sm"
                >
                  <ion-icon name="close-outline" class="mr-2"></ion-icon>
                  Cancel
                </button>

                <!-- Create/Update Service -->
                <button
                  type="submit"
                  [disabled]="serviceForm.invalid || isSavingService"
                  class="px-8 py-3 bg-gradient-to-r from-indigo-500 to-indigo-600 hover:from-indigo-600 hover:to-indigo-700 disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed text-white rounded-xl font-bold transition-all duration-200 transform hover:scale-105 shadow-lg flex items-center"
                >
                  <ion-icon
                    [name]="isSavingService ? 'hourglass' : (isEditingService ? 'checkmark-circle-outline' : 'add-circle-outline')"
                    class="mr-2"
                  ></ion-icon>
                  {{ isSavingService ? 'Saving...' : (isEditingService ? 'Update
                  Service' : 'Create Service') }}
                </button>
              </div>
            </div>

            <!-- Form Status -->
            <div class="mt-4 flex items-center justify-center">
              <div
                *ngIf="serviceForm.valid"
                class="flex items-center text-green-600 text-sm bg-green-50 px-4 py-2 rounded-lg border border-green-200"
              >
                <ion-icon name="checkmark-circle" class="mr-2"></ion-icon>
                Ready to create service
              </div>
              <div
                *ngIf="serviceForm.invalid"
                class="flex items-center text-amber-600 text-sm bg-amber-50 px-4 py-2 rounded-lg border border-amber-200"
              >
                <ion-icon name="warning" class="mr-2"></ion-icon>
                Please complete all required fields
              </div>
            </div>
          </div>
        </form>
      </div>
    </ion-content>
  </ng-template>
</ion-modal>

<!-- Client Details Modal -->
<ion-modal
  #clientDetailsModal
  [isOpen]="isClientModalOpen"
  (willDismiss)="closeClientModal()"
  class="custom-modal large-modal"
>
  <ng-template>
    <ion-header class="ion-no-border">
      <ion-toolbar class="custom-toolbar">
        <div
          class="flex items-center justify-between p-6 bg-gradient-to-r from-blue-50 to-indigo-50 border-b border-gray-200"
        >
          <div class="flex items-center">
            <div
              class="bg-gradient-to-br from-blue-500 to-blue-600 w-12 h-12 rounded-xl flex items-center justify-center text-white mr-4 shadow-lg"
            >
              <ion-icon name="person" class="text-xl"></ion-icon>
            </div>
            <div>
              <h2 class="text-2xl font-bold text-gray-800">Client Details</h2>
              <p class="text-gray-600 text-sm">
                View comprehensive client information
              </p>
            </div>
          </div>
          <button
            (click)="closeClientModal()"
            class="p-3 text-gray-500 hover:text-gray-700 hover:bg-white/50 rounded-xl transition-all duration-200"
          >
            <ion-icon name="close" class="text-2xl"></ion-icon>
          </button>
        </div>
      </ion-toolbar>
    </ion-header>

    <ion-content class="custom-modal-content" *ngIf="selectedClient">
      <div class="max-w-4xl mx-auto p-8">
        <!-- Client Profile Section -->
        <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
          <div class="flex items-center mb-6">
            <div
              class="bg-gradient-to-br from-blue-400 to-blue-500 w-20 h-20 rounded-full flex items-center justify-center text-white mr-6 shadow-lg"
            >
              <span class="text-3xl font-bold"
                >{{ selectedClient.fullName.charAt(0).toUpperCase() }}</span
              >
            </div>
            <div class="flex-1">
              <h3 class="text-3xl font-bold text-gray-800 mb-2">
                {{ selectedClient.fullName }}
              </h3>
              <div class="flex items-center space-x-4">
                <span
                  class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-semibold"
                  >{{ selectedClient.role | titlecase }}</span
                >
                <span class="text-gray-500 text-sm"
                  >Member since {{ selectedClient.createdAt | date:'MMMM yyyy'
                  }}</span
                >
              </div>
            </div>
          </div>

          <!-- Contact Information -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="space-y-4">
              <h4 class="text-lg font-semibold text-gray-800 mb-3">
                Contact Information
              </h4>
              <div class="flex items-center p-3 bg-gray-50 rounded-lg">
                <ion-icon
                  name="mail"
                  class="text-blue-500 mr-3 text-xl"
                ></ion-icon>
                <div>
                  <div class="text-sm text-gray-600">Email Address</div>
                  <div class="font-semibold text-gray-800">
                    {{ selectedClient.email }}
                  </div>
                </div>
              </div>
              <div class="flex items-center p-3 bg-gray-50 rounded-lg">
                <ion-icon
                  name="call"
                  class="text-green-500 mr-3 text-xl"
                ></ion-icon>
                <div>
                  <div class="text-sm text-gray-600">Phone Number</div>
                  <div class="font-semibold text-gray-800">
                    {{ selectedClient.phone || 'Not provided' }}
                  </div>
                </div>
              </div>
            </div>

            <div class="space-y-4">
              <h4 class="text-lg font-semibold text-gray-800 mb-3">
                Account Information
              </h4>
              <div class="flex items-center p-3 bg-gray-50 rounded-lg">
                <ion-icon
                  name="calendar"
                  class="text-purple-500 mr-3 text-xl"
                ></ion-icon>
                <div>
                  <div class="text-sm text-gray-600">Registration Date</div>
                  <div class="font-semibold text-gray-800">
                    {{ selectedClient.createdAt | date:'MMM dd, yyyy - h:mm a'
                    }}
                  </div>
                </div>
              </div>
              <div class="flex items-center p-3 bg-gray-50 rounded-lg">
                <ion-icon
                  name="finger-print"
                  class="text-orange-500 mr-3 text-xl"
                ></ion-icon>
                <div>
                  <div class="text-sm text-gray-600">User ID</div>
                  <div class="font-semibold text-gray-800 font-mono text-sm">
                    {{ selectedClient.uid }}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Saved Locations Section -->
        <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
          <div class="flex items-center justify-between mb-6">
            <h4 class="text-xl font-semibold text-gray-800 flex items-center">
              <ion-icon
                name="location"
                class="text-red-500 mr-3 text-2xl"
              ></ion-icon>
              Saved Locations
            </h4>
            <span
              class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm font-semibold"
            >
              {{ selectedClient.savedLocations?.length || 0 }} location(s)
            </span>
          </div>

          <div
            *ngIf="selectedClient.savedLocations && selectedClient.savedLocations.length > 0; else noSavedLocations"
          >
            <div class="grid grid-cols-1 gap-4">
              <div
                *ngFor="let location of selectedClient.savedLocations; let i = index"
                class="border border-gray-200 rounded-xl p-4 hover:shadow-md transition-shadow"
              >
                <div class="flex items-start justify-between">
                  <div class="flex-1">
                    <div class="flex items-center mb-2">
                      <ion-icon
                        name="home"
                        class="text-blue-500 mr-2"
                      ></ion-icon>
                      <span class="font-semibold text-gray-800"
                        >{{ location.contactPerson }}</span
                      >
                      <span
                        *ngIf="location.isDefault"
                        class="ml-2 bg-green-100 text-green-800 px-2 py-1 rounded text-xs font-medium"
                        >Default</span
                      >
                    </div>
                    <div class="text-gray-600 mb-2">
                      {{ location.fullAddress }}
                    </div>
                    <div class="flex items-center text-sm text-gray-500">
                      <ion-icon name="call" class="mr-1"></ion-icon>
                      {{ location.phoneNumber }}
                    </div>
                  </div>
                  <div class="text-xs text-gray-500">
                    {{ location.createdAt | date:'MMM dd, yyyy' }}
                  </div>
                </div>
              </div>
            </div>
          </div>

          <ng-template #noSavedLocations>
            <div class="text-center py-8">
              <ion-icon
                name="location-outline"
                class="text-6xl text-gray-300 mb-4"
              ></ion-icon>
              <h5 class="text-lg font-semibold text-gray-600 mb-2">
                No Saved Locations
              </h5>
              <p class="text-gray-500">
                This client hasn't saved any locations yet.
              </p>
            </div>
          </ng-template>
        </div>

        <!-- Action Buttons -->
        <div class="flex justify-end space-x-4">
          <button
            (click)="closeClientModal()"
            class="px-6 py-3 border-2 border-gray-300 text-gray-600 rounded-xl font-semibold hover:bg-gray-50 hover:border-gray-400 transition-all duration-200 flex items-center"
          >
            <ion-icon name="close-outline" class="mr-2"></ion-icon>
            Close
          </button>
          <button
            (click)="sendMessageToClient(selectedClient)"
            class="px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-xl font-semibold transition-all duration-200 transform hover:scale-105 shadow-lg flex items-center"
          >
            <ion-icon name="chatbubble" class="mr-2"></ion-icon>
            Send Message
          </button>
        </div>
      </div>
    </ion-content>
  </ng-template>
</ion-modal>
