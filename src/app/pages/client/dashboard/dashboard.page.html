<ion-content
  [fullscreen]="true"
  class="bg-gradient-to-br from-handy-blue-50 via-white to-handy-yellow-50"
>
  <!-- Custom Header -->
  <div
    class="bg-gradient-to-r from-handy-blue-500 to-handy-blue-600 pt-3 pb-3 px-6 rounded-bl-3xl rounded-br-3xl shadow-lg mb-4"
  >
    <div class="flex items-center justify-between">
      <h1 class="text-white text-2xl font-bold">HandyHome</h1>
      <div class="flex items-center space-x-4">
        <button
          (click)="openNotificationModal()"
          class="p-2 rounded-full bg-white/20 hover:bg-white/30 transition-colors duration-200 relative"
        >
          <ion-icon
            name="notifications-outline"
            class="text-white text-xl"
          ></ion-icon>
          <!-- Notification badge -->
          <div
            *ngIf="unreadCount > 0"
            class="absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center font-bold"
          >
            {{ unreadCount > 9 ? '9+' : unreadCount }}
          </div>
        </button>
        <button
          (click)="goToProfile()"
          class="p-2 rounded-full bg-white/20 hover:bg-white/30 transition-colors duration-200"
        >
          <ion-icon name="person-outline" class="text-white text-xl"></ion-icon>
        </button>
      </div>
    </div>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="flex justify-center items-center h-64">
    <div
      class="animate-spin rounded-full h-16 w-16 border-b-2 border-handy-blue-500"
    ></div>
  </div>

  <div *ngIf="!isLoading" class="px-4 pb-20">
    <!-- Welcome Header -->
    <div class="bg-white rounded-3xl shadow-xl p-6 mb-6 mx-4">
      <div class="flex items-center">
        <!-- HandyHome Logo -->
        <div class="relative mr-4">
          <img
            src="assets/HandyHome.png"
            alt="HandyHome Logo"
            class="w-16 h-16 transform hover:scale-105 transition-transform duration-300 drop-shadow-lg"
            onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'"
          />
          <!-- Fallback icon if logo not found -->
          <div
            class="w-16 h-16 bg-gradient-to-br from-handy-blue-500 to-handy-blue-600 rounded-2xl hidden items-center justify-center shadow-lg"
          >
            <ion-icon name="home" class="text-2xl text-white"></ion-icon>
          </div>
        </div>
        <div class="flex-1">
          <h2 class="text-xl font-bold text-gray-800 mb-1">
            {{ getGreeting() }}, {{ (userProfile?.fullName || 'Guest').split('
            ')[0] }}!
          </h2>
          <p class="text-gray-600 text-base mb-4 text-sm">
            Ready to find your perfect service?
          </p>
          <button
            (click)="bookService()"
            class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-2xl font-semibold text-sm shadow-lg transform hover:scale-105 transition-all duration-300"
          >
            Book a service
          </button>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="mb-6">
      <h3 class="text-xl font-bold text-handy-navy-800 mb-4 px-2">
        Quick Actions
      </h3>
      <div class="grid grid-cols-2 gap-4">
        <button
          (click)="bookService()"
          class="bg-gradient-to-r from-handy-blue-500 to-handy-blue-600 hover:from-handy-blue-600 hover:to-handy-blue-700 text-white p-4 rounded-xl shadow-lg transform hover:scale-105 transition-all duration-300 flex items-center"
        >
          <ion-icon name="add-circle-outline" class="text-2xl mr-3"></ion-icon>
          <div class="flex-1 text-left">
            <p class="font-semibold text-sm">Book Service</p>
            <p class="text-xs opacity-75 leading-tight">Find professionals</p>
          </div>
        </button>
        <button
          (click)="viewBookings()"
          class="bg-gradient-to-r from-handy-yellow-500 to-handy-yellow-600 hover:from-handy-yellow-600 hover:to-handy-yellow-700 text-white p-4 rounded-xl shadow-lg transform hover:scale-105 transition-all duration-300 flex items-center"
        >
          <ion-icon name="calendar-outline" class="text-2xl mr-3"></ion-icon>
          <div class="flex-1 text-left">
            <p class="font-semibold text-sm">My Bookings</p>
            <p class="text-xs opacity-75 leading-tight">View appointments</p>
          </div>
        </button>
        <button
          (click)="quickBooking()"
          class="bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white p-4 rounded-xl shadow-lg transform hover:scale-105 transition-all duration-300 flex items-center"
        >
          <ion-icon name="flash-outline" class="text-2xl mr-3"></ion-icon>
          <div class="flex-1 text-left">
            <p class="font-semibold text-sm">Quick Booking</p>
            <p class="text-xs opacity-75 leading-tight">Fast service</p>
          </div>
        </button>
        <button
          (click)="viewQuickBookingsHistory()"
          class="bg-gradient-to-r from-purple-500 to-indigo-600 hover:from-purple-600 hover:to-indigo-700 text-white p-4 rounded-xl shadow-lg transform hover:scale-105 transition-all duration-300 flex items-center"
        >
          <ion-icon name="time-outline" class="text-2xl mr-3"></ion-icon>
          <div class="flex-1 text-left">
            <p class="font-semibold text-sm">Quick Bookings</p>
            <p class="text-xs opacity-75 leading-tight">View history</p>
          </div>
        </button>
      </div>
    </div>

    <!-- Upcoming / Active Bookings -->
    <!-- <div class="mb-6" *ngIf="upcomingBookings.length > 0">
      <h3 class="text-xl font-bold text-handy-navy-800 mb-4 px-2">
        Active Bookings
      </h3>
      <div class="space-y-4">
        <div
          *ngFor="let booking of upcomingBookings"
          class="bg-white/80 backdrop-blur-md rounded-2xl shadow-lg p-5 border border-white/20"
        >
          <div class="flex items-center justify-between mb-3">
            <div class="flex items-center">
              <div
                class="w-12 h-12 bg-gradient-to-br from-handy-blue-500 to-handy-blue-600 rounded-full flex items-center justify-center shadow-md"
              >
                <ion-icon name="person" class="text-white text-lg"></ion-icon>
              </div>
              <div class="ml-3">
                <h4 class="font-semibold text-handy-navy-800">
                  {{ booking.workerName }}
                </h4>
                <p class="text-sm text-handy-navy-600">
                  {{ booking.serviceType }}
                </p>
              </div>
            </div>
            <span
              class="px-3 py-1 rounded-full text-xs font-medium"
              [ngClass]="getStatusColor(booking.status)"
            >
              {{ booking.status | titlecase }}
            </span>
          </div>
          <div
            class="flex items-center justify-between text-sm text-handy-navy-600 mb-3"
          >
            <div class="flex items-center">
              <ion-icon name="calendar-outline" class="mr-1"></ion-icon>
              {{ booking.scheduledDate | date:'MMM d, y' }}
            </div>
            <div class="flex items-center">
              <ion-icon name="time-outline" class="mr-1"></ion-icon>
              {{ booking.scheduledTime }}
            </div>
          </div>
          <button
            *ngIf="booking.status === 'on-the-way' || booking.status === 'in-progress'"
            (click)="trackWorker(booking)"
            class="w-full bg-gradient-to-r from-handy-blue-500 to-handy-blue-600 hover:from-handy-blue-600 hover:to-handy-blue-700 text-white py-2 px-4 rounded-xl font-medium text-sm transition-all duration-300 flex items-center justify-center"
          >
            <ion-icon name="navigate-outline" class="mr-2"></ion-icon>
            Track Worker
          </button>
        </div>
      </div>
    </div> -->

    <!-- Promotional Ads Section -->
    <div class="mb-6" *ngIf="ads.length > 0">
      <h3 class="text-xl font-bold text-handy-navy-800 mb-4 px-2">
        Special Offers
      </h3>
      <div class="relative">
        <swiper-container
          slides-per-view="1.2"
          space-between="16"
          centered-slides="false"
          pagination="true"
          pagination-clickable="true"
          autoplay-delay="4000"
          autoplay-disable-on-interaction="false"
          loop="true"
          class="ads-swiper"
        >
          <swiper-slide *ngFor="let ad of ads" class="!h-auto">
            <div
              class="relative overflow-hidden shadow-lg cursor-pointer transform transition-all duration-300 hover:scale-105"
              (click)="onAdClick(ad)"
            >
              <!-- Ad Image -->
              <img
                [src]="ad.imageUrl"
                [alt]="ad.altText"
                class="w-full h-48 object-contain bg-gray-100"
                (error)="onImageError($event, ad)"
              />

              <!-- Overlay for better interaction feedback -->
              <div
                class="absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-10 transition-all duration-300"
              ></div>

              <!-- Loading placeholder (shown while image loads) -->
              <div
                class="absolute inset-0 bg-gradient-to-br from-gray-200 to-gray-300 flex items-center justify-center"
                [class.hidden]="!ad.isLoading"
              >
                <div
                  class="animate-spin rounded-full h-8 w-8 border-b-2 border-handy-blue-500"
                ></div>
              </div>
            </div>
          </swiper-slide>
        </swiper-container>
      </div>
    </div>

    <!-- Service Categories -->
    <!-- <div class="mb-6">
      <h3 class="text-xl font-bold text-handy-navy-800 mb-4 px-2">
        Service Categories
      </h3>
      <div class="overflow-x-auto">
        <div class="flex space-x-4 pb-2">
          <div
            *ngFor="let category of serviceCategories"
            (click)="bookService(category.id)"
            class="flex-shrink-0 w-28 bg-white/80 backdrop-blur-md rounded-2xl shadow-lg p-4 border border-white/20 cursor-pointer transform hover:scale-105 transition-all duration-300"
          >
            <div
              class="w-12 h-12 rounded-xl flex items-center justify-center mb-3"
              [style.background]="'linear-gradient(135deg, ' + category.color + ', ' + category.color + 'cc)'"
            >
              <ion-icon
                [name]="category.icon"
                class="text-white text-xl"
              ></ion-icon>
            </div>
            <h4 class="font-semibold text-handy-navy-800 text-sm mb-1">
              {{ category.name }}
            </h4>
            <p class="text-xs text-handy-navy-600">
              {{ category.description }}
            </p>
          </div>
        </div>
      </div>
    </div> -->

    <!-- Recent Workers / Favorites -->
    <div class="mb-6" *ngIf="recentWorkers.length > 0">
      <h3 class="text-xl font-bold text-handy-navy-800 mb-4 px-2">
        Recent Workers
      </h3>
      <div class="space-y-3">
        <div
          *ngFor="let worker of recentWorkers"
          class="bg-white/80 backdrop-blur-md rounded-2xl shadow-lg p-4 border border-white/20 flex items-center justify-between"
        >
          <div class="flex items-center">
            <div class="relative">
              <div
                class="w-14 h-14 bg-gradient-to-br from-handy-blue-500 to-handy-blue-600 rounded-full flex items-center justify-center shadow-md"
              >
                <ion-icon name="person" class="text-white text-xl"></ion-icon>
              </div>
              <div
                class="absolute -bottom-1 -right-1 w-4 h-4 rounded-full border-2 border-white"
                [ngClass]="worker.isOnline ? 'bg-green-500' : 'bg-gray-400'"
              ></div>
            </div>
            <div class="ml-4">
              <h4 class="font-semibold text-handy-navy-800">
                {{ worker.fullName }}
              </h4>
              <div class="flex items-center mb-1">
                <div class="flex items-center mr-2">
                  <ion-icon
                    name="star"
                    class="text-yellow-500 text-sm mr-1"
                  ></ion-icon>
                  <span class="text-sm font-medium text-handy-navy-700"
                    >{{ worker.rating }}</span
                  >
                </div>
                <span class="text-xs text-handy-navy-600"
                  >{{ worker.totalJobs }} jobs</span
                >
              </div>
              <p class="text-xs text-handy-navy-600">
                {{ worker.services.join(', ') }}
              </p>
            </div>
          </div>
          <button
            (click)="rebookWorker(worker.id)"
            class="bg-gradient-to-r from-handy-yellow-500 to-handy-yellow-600 hover:from-handy-yellow-600 hover:to-handy-yellow-700 text-white px-4 py-2 rounded-xl font-medium text-sm transition-all duration-300"
          >
            Rebook
          </button>
        </div>
      </div>
    </div>

    <!-- Notifications / Updates -->
    <div class="mb-6" *ngIf="notifications.length > 0">
      <h3 class="text-xl font-bold text-handy-navy-800 mb-4 px-2">
        Updates & Notifications
      </h3>
      <div class="space-y-3">
        <div
          *ngFor="let notification of notifications"
          class="bg-white/80 backdrop-blur-md rounded-2xl shadow-lg p-4 border border-white/20"
        >
          <div class="flex items-start">
            <div
              class="w-10 h-10 rounded-full flex items-center justify-center mr-3"
              [ngClass]="{
                'bg-blue-100': notification.type === 'reminder',
                'bg-green-100': notification.type === 'promotion',
                'bg-yellow-100': notification.type === 'update'
              }"
            >
              <ion-icon
                [name]="notification.type === 'reminder' ? 'notifications-outline' : 
                       notification.type === 'promotion' ? 'gift-outline' : 
                       'information-circle-outline'"
                class="text-lg"
                [ngClass]="{
                  'text-blue-600': notification.type === 'reminder',
                  'text-green-600': notification.type === 'promotion',
                  'text-yellow-600': notification.type === 'update'
                }"
              ></ion-icon>
            </div>
            <div class="flex-1">
              <h4 class="font-semibold text-handy-navy-800 text-sm">
                {{ notification.title }}
              </h4>
              <p class="text-handy-navy-600 text-sm mt-1">
                {{ notification.message }}
              </p>
              <p class="text-xs text-handy-navy-500 mt-2">
                {{ notification.timestamp | date:'short' }}
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <!-- <div
      *ngIf="upcomingBookings.length === 0 && recentWorkers.length === 0"
      class="text-center py-12"
    >
      <div
        class="w-24 h-24 bg-gradient-to-br from-handy-blue-500 to-handy-blue-600 rounded-full flex items-center justify-center mx-auto mb-6 shadow-xl"
      >
        <ion-icon name="home-outline" class="text-4xl text-white"></ion-icon>
      </div>
      <h3 class="text-xl font-bold text-handy-navy-800 mb-2">
        Welcome to HandyHome!
      </h3>
      <p class="text-handy-navy-600 mb-6 px-4">
        Book your first service to get started and make your home tasks easier.
      </p>
      <button
        (click)="bookService()"
        class="bg-gradient-to-r from-handy-blue-500 to-handy-blue-600 hover:from-handy-blue-600 hover:to-handy-blue-700 text-white px-8 py-3 rounded-2xl font-semibold shadow-lg transform hover:scale-105 transition-all duration-300"
      >
        Book Your First Service
      </button>
    </div> -->
  </div>

  <!-- Notification Modal -->
  <div
    *ngIf="showNotificationModal"
    class="fixed inset-0 z-50 flex items-start justify-center pt-4 px-4"
    (click)="closeNotificationModal($event)"
  >
    <!-- Backdrop -->
    <div class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm"></div>

    <!-- Modal Container -->
    <div
      class="relative bg-white rounded-2xl shadow-2xl w-full max-w-md max-h-[80vh] overflow-hidden transform transition-all duration-300 animate-slide-down"
      (click)="$event.stopPropagation()"
    >
      <!-- Modal Header -->
      <div
        class="bg-gradient-to-r from-handy-blue-500 to-handy-blue-600 px-6 py-4"
      >
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-3">
            <div
              class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center"
            >
              <ion-icon
                name="notifications"
                class="text-white text-xl"
              ></ion-icon>
            </div>
            <div>
              <h3 class="text-lg font-semibold text-white">Notifications</h3>
              <p class="text-handy-blue-100 text-sm">
                {{ clientNotifications.length }} total, {{ unreadCount }} unread
              </p>
            </div>
          </div>
          <div
            class="flex items-center space-x-2"
            *ngIf="clientNotifications.length > 0"
          >
            <button
              (click)="clearAllClientNotifications()"
              class="text-sm text-blue-100 hover:text-white font-medium bg-white/10 hover:bg-white/20 px-3 py-1 rounded-lg transition-all duration-200"
            >
              Clear all
            </button>
            <button
              (click)="closeNotificationModal()"
              class="p-2 rounded-full bg-white/20 hover:bg-white/30 transition-all duration-200"
            >
              <ion-icon name="close" class="text-white text-xl"></ion-icon>
            </button>
          </div>
          <button
            *ngIf="clientNotifications.length === 0"
            (click)="closeNotificationModal()"
            class="p-2 rounded-full bg-white/20 hover:bg-white/30 transition-all duration-200"
          >
            <ion-icon name="close" class="text-white text-xl"></ion-icon>
          </button>
        </div>
      </div>

      <!-- Modal Content -->
      <div class="overflow-y-auto max-h-96">
        <div class="p-4 space-y-3" *ngIf="clientNotifications.length > 0">
          <div
            *ngFor="let notification of clientNotifications"
            (click)="onNotificationClick(notification)"
            class="flex items-start p-4 rounded-xl cursor-pointer transition-all duration-200 border border-transparent hover:border-gray-200 hover:shadow-md"
            [class]="!notification.isRead ? 'bg-blue-50 border-blue-200 hover:bg-blue-100' : 'bg-gray-50 hover:bg-gray-100'"
          >
            <div class="flex-shrink-0 mr-3">
              <div
                class="w-12 h-12 rounded-full flex items-center justify-center relative"
                [ngClass]="{
                  'bg-green-100': notification.type === 'worker_found' || notification.type === 'booking',
                  'bg-blue-100': notification.type === 'booking_update',
                  'bg-yellow-100': notification.type === 'promotion',
                  'bg-purple-100': notification.type === 'system'
                }"
              >
                <ion-icon
                  [name]="getNotificationIcon(notification.type)"
                  class="text-lg"
                  [ngClass]="{
                    'text-green-600': notification.type === 'worker_found' || notification.type === 'booking',
                    'text-blue-600': notification.type === 'booking_update',
                    'text-yellow-600': notification.type === 'promotion',
                    'text-purple-600': notification.type === 'system'
                  }"
                ></ion-icon>
                <div
                  *ngIf="!notification.isRead"
                  class="absolute -top-1 -right-1 w-4 h-4 bg-blue-500 rounded-full border-2 border-white"
                ></div>
              </div>
            </div>

            <div class="flex-1 min-w-0">
              <div class="flex items-start justify-between mb-1">
                <p class="text-sm font-semibold text-gray-800 leading-tight">
                  {{ notification.title }}
                </p>
                <span class="text-xs text-gray-500 whitespace-nowrap ml-2">
                  {{ getTimeAgo(getNotificationDate(notification.createdAt)) }}
                </span>
              </div>
              <p class="text-sm text-gray-600 leading-relaxed mb-2">
                {{ notification.message }}
              </p>
            </div>
          </div>
        </div>

        <!-- Empty State -->
        <div *ngIf="clientNotifications.length === 0" class="text-center py-12">
          <div
            class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4"
          >
            <ion-icon
              name="notifications-off-outline"
              class="text-2xl text-gray-400"
            ></ion-icon>
          </div>
          <h4 class="text-lg font-semibold text-gray-800 mb-2">
            No notifications yet
          </h4>
          <p class="text-gray-500 text-sm">
            You'll receive notifications when workers accept your bookings
          </p>
        </div>
      </div>
    </div>
  </div>
</ion-content>
