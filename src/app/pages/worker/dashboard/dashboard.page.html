<ion-content [fullscreen]="true" class="bg-gradient-to-br from-green-50 via-white to-emerald-50 relative z-0">
  <!-- Custom Header -->
  <div class="bg-gradient-to-r from-green-600 via-emerald-600 to-teal-600 pt-12 pb-6 px-6 rounded-bl-3xl rounded-br-3xl shadow-xl mb-6 relative overflow-hidden">
    <!-- Background Pattern -->
    <div class="absolute inset-0 opacity-10">
      <div class="absolute top-0 left-0 w-32 h-32 bg-white rounded-full -translate-x-16 -translate-y-16"></div>
      <div class="absolute top-8 right-8 w-20 h-20 bg-white rounded-full opacity-20"></div>
      <div class="absolute bottom-0 right-0 w-40 h-40 bg-white rounded-full translate-x-20 translate-y-20"></div>
    </div>
    
    <div class="relative z-10">
      <div class="flex items-center justify-between mb-3">
        <div class="flex items-center space-x-4">
          <div>
            <h1 class="text-white text-2xl font-bold">Worker Dashboard</h1>
            <p class="text-green-100 text-sm">Manage Your HandyHome Jobs</p>
          </div>
        </div>
        <div class="flex items-center space-x-2">
          <button 
            (click)="toggleAvailability()"
            [class]="isAvailable ? 'bg-green-400/30' : 'bg-red-400/30'"
            class="p-2 rounded-xl hover:bg-white/30 transition-all duration-200 backdrop-blur-sm">
            <ion-icon [name]="isAvailable ? 'power' : 'power-outline'" 
                      [class]="isAvailable ? 'text-white' : 'text-white/70'"
                      class="text-xl"></ion-icon>
          </button>
          <button 
            (click)="logout()"
            class="p-2 rounded-xl bg-white/20 hover:bg-white/30 transition-all duration-200 backdrop-blur-sm">
            <ion-icon name="log-out-outline" class="text-white text-xl"></ion-icon>
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="p-4">
    <!-- Profile Summary Card -->
    <div class="bg-white rounded-2xl shadow-lg p-6 mb-6 border border-green-100">
      <div class="flex items-center mb-4">
        <!-- Profile Picture -->
        <div class="relative mr-4">
          <div class="w-20 h-20 bg-gradient-to-br from-green-100 to-emerald-100 rounded-full flex items-center justify-center overflow-hidden border-2 border-green-200">
            <img *ngIf="workerProfile?.profilePhotoData" 
                 [src]="workerProfile?.profilePhotoData" 
                 alt="Profile"
                 class="w-full h-full object-cover">
            <span *ngIf="!workerProfile?.profilePhotoData" 
                  class="text-green-600 font-bold text-2xl">
              {{ getInitials(userProfile?.fullName || 'W') }}
            </span>
          </div>
          <!-- Verification Badge -->
          <div *ngIf="workerProfile?.status === 'verified'" 
               class="absolute -bottom-1 -right-1 bg-green-500 rounded-full p-2 border-2 border-white">
            <ion-icon name="checkmark" class="text-white text-sm"></ion-icon>
          </div>
        </div>
        
        <div class="flex-1">
          <h2 class="text-2xl font-bold text-gray-800">{{ userProfile?.fullName || 'Worker' }}</h2>
          <div class="flex items-center mt-1">
            <span [class]="workerProfile?.status === 'verified' ? 'text-green-600' : 'text-orange-600'" 
                  class="text-sm font-medium mr-3">
              {{ workerProfile?.status === 'verified' ? 'Verified Worker' : 'Pending Verification' }}
            </span>
            <div class="flex items-center" *ngIf="workerProfile?.rating">
              <ion-icon name="star" class="text-yellow-500 text-sm mr-1"></ion-icon>
              <span class="text-sm text-gray-600">{{ workerProfile?.rating | number:'1.1-1' }}</span>
            </div>
          </div>
          
          <!-- Availability Status -->
          <div class="flex items-center mt-2">
            <div [class]="isAvailable ? 'bg-green-500' : 'bg-red-500'" 
                 class="w-2 h-2 rounded-full mr-2"></div>
            <span class="text-sm text-gray-600">{{ isAvailable ? 'Available for Jobs' : 'Offline' }}</span>
          </div>
        </div>
      </div>

      <!-- Quick Stats Cards -->
      <div class="grid grid-cols-3 gap-4">
        <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-4 text-center border border-blue-200">
          <div class="text-2xl font-bold text-blue-700">{{ workerStats.jobsCompleted || 0 }}</div>
          <div class="text-xs text-blue-600 font-medium">Jobs Done</div>
        </div>
        <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-4 text-center border border-green-200">
          <div class="text-2xl font-bold text-green-700">₱{{ workerStats.monthlyEarnings | number:'1.0-0' }}</div>
          <div class="text-xs text-green-600 font-medium">This Month</div>
        </div>
        <div class="bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-xl p-4 text-center border border-yellow-200">
          <div class="text-2xl font-bold flex items-center justify-center text-yellow-700">
            <ion-icon name="star" class="text-yellow-500 mr-1"></ion-icon>
            {{ (workerProfile?.rating || 0) | number:'1.1-1' }}
          </div>
          <div class="text-xs text-yellow-600 font-medium">Rating</div>
        </div>
      </div>
    </div>

    <!-- Job Feed (Available Bookings) -->
    <div class="mb-6" *ngIf="availableJobs.length > 0">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-xl font-semibold text-gray-800">Available Jobs</h3>
        <ion-button fill="clear" size="small" (click)="refreshJobs()">
          <ion-icon name="refresh" slot="icon-only"></ion-icon>
        </ion-button>
      </div>
      
      <div class="space-y-4">
        <div *ngFor="let job of availableJobs" class="bg-white rounded-xl shadow-lg p-4">
          <div class="flex justify-between items-start mb-3">
            <div class="flex-1">
              <h4 class="font-semibold text-gray-800 mb-1">{{ job.title }}</h4>
              <p class="text-gray-600 text-sm mb-2">{{ job.description }}</p>
              <div class="flex items-center text-sm text-gray-500 mb-1">
                <ion-icon name="location-outline" class="mr-1"></ion-icon>
                <span>{{ job.locations[0]?.address }}</span>
                <span *ngIf="job.distance" class="ml-2 text-blue-600">
                  ({{ job.distance | number:'1.1-1' }} km away)
                </span>
              </div>
              <div class="flex items-center text-sm text-gray-500">
                <ion-icon name="time-outline" class="mr-1"></ion-icon>
                <span>{{ job.schedule.date }} at {{ job.schedule.time }}</span>
              </div>
            </div>
            
            <div class="text-right ml-4">
              <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-medium">
                {{ job.category }}
              </span>
            </div>
          </div>

          <!-- Price Breakdown -->
          <div class="bg-gray-50 rounded-lg p-3 mb-4">
            <div class="flex justify-between text-sm text-gray-600 mb-1">
              <span>Service Price:</span>
              <span>₱{{ job.price | number:'1.2-2' }}</span>
            </div>
            <div class="flex justify-between text-sm text-gray-600 mb-1">
              <span>Service Fee:</span>
              <span>-₱{{ job.serviceCharge | number:'1.2-2' }}</span>
            </div>
            <div class="flex justify-between text-sm text-gray-600 mb-1">
              <span>Transport Fee:</span>
              <span>₱{{ job.transportFee | number:'1.2-2' }}</span>
            </div>
            <div class="border-t pt-1 mt-1">
              <div class="flex justify-between font-semibold text-gray-800">
                <span>Your Payout:</span>
                <span>₱{{ (job.price - job.serviceCharge + job.transportFee) | number:'1.2-2' }}</span>
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="flex space-x-3">
            <button 
              (click)="acceptJob(job)"
              [disabled]="job.isProcessing"
              class="flex-1 bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50">
              <span *ngIf="!job.isProcessing">Accept Job</span>
              <span *ngIf="job.isProcessing">Processing...</span>
            </button>
            <button 
              (click)="declineJob(job)"
              class="flex-1 bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-medium transition-colors">
              Decline
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State for Available Jobs -->
    <div *ngIf="availableJobs.length === 0" class="bg-white rounded-xl shadow-lg p-6 mb-6 text-center">
      <ion-icon name="briefcase-outline" class="text-6xl text-gray-300 mb-4"></ion-icon>
      <h3 class="text-lg font-semibold text-gray-600 mb-2">No Available Jobs</h3>
      <p class="text-gray-500 text-sm mb-4">Check back later for new job opportunities matching your skills.</p>
      <ion-button fill="clear" (click)="refreshJobs()">
        <ion-icon name="refresh" slot="start"></ion-icon>
        Refresh Jobs
      </ion-button>
    </div>

    <!-- Ongoing Jobs -->
    <div class="mb-6" *ngIf="ongoingJobs.length > 0">
      <h3 class="text-xl font-semibold text-gray-800 mb-4">My Active Jobs</h3>
      
      <div class="space-y-4">
        <div *ngFor="let job of ongoingJobs" class="bg-white rounded-xl shadow-lg p-4 border-l-4 border-blue-500">
          <div class="flex justify-between items-start mb-3">
            <div class="flex-1">
              <div class="flex items-center mb-2">
                <h4 class="font-semibold text-gray-800 mr-2">{{ job.title }}</h4>
                <span [class]="getStatusBadgeClass(job.status)" class="px-2 py-1 rounded-full text-xs font-medium">
                  {{ job.status }}
                </span>
              </div>
              <p class="text-gray-600 text-sm mb-2">{{ job.description }}</p>
              
              <!-- Client Contact Info -->
              <div class="bg-blue-50 rounded-lg p-3 mb-3">
                <h5 class="font-medium text-blue-800 mb-1">Client Information</h5>
                <div class="text-sm text-blue-700">
                  <p>{{ job.clientName || 'Client' }}</p>
                  <div class="flex items-center mt-1">
                    <ion-icon name="call-outline" class="mr-1"></ion-icon>
                    <span>{{ job.clientPhone || 'Contact via app' }}</span>
                  </div>
                </div>
              </div>
              
              <div class="flex items-center text-sm text-gray-500 mb-1">
                <ion-icon name="location-outline" class="mr-1"></ion-icon>
                <span>{{ job.locations[0]?.address }}</span>
              </div>
              <div class="flex items-center text-sm text-gray-500">
                <ion-icon name="time-outline" class="mr-1"></ion-icon>
                <span>{{ job.schedule.date }} at {{ job.schedule.time }}</span>
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="flex space-x-3 mt-4">
            <button 
              *ngIf="job.status === 'accepted'"
              (click)="startJob(job)"
              [disabled]="job.isProcessing"
              class="flex-1 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50">
              <span *ngIf="!job.isProcessing">Start Job</span>
              <span *ngIf="job.isProcessing">Starting...</span>
            </button>
            <button 
              *ngIf="job.status === 'in-progress'"
              (click)="completeJob(job)"
              [disabled]="job.isProcessing"
              class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50">
              <span *ngIf="!job.isProcessing">Mark as Completed</span>
              <span *ngIf="job.isProcessing">Completing...</span>
            </button>
            <button 
              (click)="viewJobLocation(job)"
              class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition-colors">
              <ion-icon name="map-outline" class="mr-1"></ion-icon>
              View Map
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State for Ongoing Jobs -->
    <div *ngIf="ongoingJobs.length === 0" class="bg-white rounded-xl shadow-lg p-6 text-center">
      <ion-icon name="checkmark-circle-outline" class="text-6xl text-gray-300 mb-4"></ion-icon>
      <h3 class="text-lg font-semibold text-gray-600 mb-2">No Active Jobs</h3>
      <p class="text-gray-500 text-sm">You don't have any ongoing jobs at the moment.</p>
    </div>
  </div>
</ion-content>
