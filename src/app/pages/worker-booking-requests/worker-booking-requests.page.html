<ion-content [fullscreen]="true" class="bg-gray-50">
  <!-- HandyHome Gradient Header -->
  <div
    class="bg-handy-blue text-white p-4 rounded-b-3xl flex items-center justify-between shadow-lg relative overflow-hidden"
  >
    <!-- Background Pattern -->
    <div class="absolute inset-0 opacity-10">
      <div
        class="absolute top-2 left-4 w-8 h-8 border-2 border-white rounded-full"
      ></div>
      <div
        class="absolute top-8 right-8 w-4 h-4 border border-white rounded-full"
      ></div>
      <div
        class="absolute bottom-4 left-12 w-6 h-6 border border-white rounded-full"
      ></div>
    </div>

    <button
      (click)="goBack()"
      class="p-2 rounded-xl hover:bg-white/20 transition-all duration-200 relative z-10"
    >
      <ion-icon name="arrow-back" size="large"></ion-icon>
    </button>

    <div class="flex flex-col items-center relative z-10">
      <div class="flex items-center space-x-2 mb-1">
        <ion-icon
          name="briefcase"
          class="text-handy-yellow-400 floating-animation text-xl"
        ></ion-icon>
        <h1 class="text-xl font-bold">Booking Requests</h1>
      </div>
      <p class="text-xs text-blue-100">Manage your service requests</p>
    </div>

    <div class="flex items-center space-x-2 relative z-10">
      <ion-badge
        class="bg-handy-yellow-500 text-handy-navy-800 font-bold animate-pulse"
        *ngIf="bookings.length > 0"
      >
        {{bookings.length}}
      </ion-badge>
      <button
        class="p-2 rounded-xl hover:bg-white/20 transition-all duration-200"
      >
        <ion-icon
          name="notifications"
          size="large"
          class="text-handy-yellow-400"
        ></ion-icon>
      </button>
    </div>
  </div>

  <!-- Content Container -->
  <div class="p-4 pt-6">
    <!-- Enhanced Loading State -->
    <div
      *ngIf="loading"
      class="flex flex-col items-center justify-center h-64 text-gray-500"
    >
      <div class="relative">
        <ion-spinner
          name="crescent"
          class="text-handy-blue-500 mb-4"
          size="large"
        ></ion-spinner>
        <div
          class="absolute inset-0 animate-ping bg-handy-blue-200 rounded-full opacity-25"
        ></div>
      </div>
      <p class="text-sm font-medium text-handy-navy-700">
        Fetching booking requests...
      </p>
      <p class="text-xs text-gray-400 mt-1">
        Please wait while we load your requests
      </p>
    </div>

    <!-- Enhanced Empty State -->
    <div
      *ngIf="!loading && bookings.length === 0"
      class="flex flex-col items-center justify-center mt-20 text-gray-500"
    >
      <div
        class="w-20 h-20 bg-gradient-to-br from-handy-blue-100 to-handy-yellow-100 rounded-2xl flex items-center justify-center mb-6 shadow-lg"
      >
        <ion-icon
          name="briefcase"
          size="large"
          class="text-handy-blue-500 floating-animation"
        ></ion-icon>
      </div>
      <p class="text-xl font-bold text-handy-navy-800 mb-2">
        No Booking Requests
      </p>
      <p class="text-sm text-gray-500 text-center px-8 leading-relaxed">
        No booking requests at the moment.<br />
        <span class="text-handy-blue-500 font-medium"
          >You'll be notified when new requests come in!</span
        >
      </p>
      <div class="mt-4 flex items-center space-x-1 text-xs text-gray-400">
        <ion-icon name="refresh" class="animate-spin"></ion-icon>
        <span>Auto-refreshing...</span>
      </div>
    </div>

    <!-- Enhanced Booking Cards -->
    <div *ngIf="!loading && bookings.length > 0" class="space-y-4">
      <div
        *ngFor="let booking of bookings"
        class="bg-white p-5 rounded-2xl shadow-md border border-handy-blue-100 hover:shadow-xl hover:border-handy-blue-200 transition-all duration-300 transform hover:-translate-y-1 hover:bg-gradient-to-br hover:from-white hover:to-handy-blue-50"
      >
        <!-- Enhanced Client Info Section -->
        <div class="flex items-center space-x-4 mb-5">
          <div class="relative">
            <!-- Icon Avatar -->
            <div class="w-14 h-14 rounded-full border-3 border-handy-yellow-400 bg-gradient-to-br from-handy-blue-500 to-handy-navy-800 flex items-center justify-center shadow-md">
              <ion-icon
                name="person"
                class="text-white text-2xl"
              ></ion-icon>
            </div>
            <div
              class="absolute -top-1 -right-1 w-5 h-5 bg-green-400 border-2 border-white rounded-full"
            ></div>
          </div>
          <div class="flex-1">
            <h3 class="font-bold text-handy-navy-800 flex items-center text-lg">
              <ion-icon
                name="person-circle"
                class="text-handy-blue-500 mr-2 text-base"
              ></ion-icon>
              {{ getClientName(booking) }}
            </h3>
            <p class="text-xs text-gray-500 flex items-center mt-2">
              <ion-icon
                name="time-outline"
                class="text-handy-blue-400 mr-2 text-sm"
              ></ion-icon>
              Posted {{ getFormattedDate(booking.createdAt) }}
            </p>
          </div>
          <div class="text-right">
            <ion-badge
              class="bg-handy-yellow-500 text-handy-navy-800 font-bold text-xs px-2 py-1"
            >
              NEW
            </ion-badge>
          </div>
        </div>

        <!-- Enhanced Booking Details -->
        <div
          class="bg-gradient-to-r from-handy-blue-50 to-handy-yellow-50 rounded-xl p-4 mb-5 border border-handy-blue-100"
        >
          <div class="space-y-3">
            <div *ngIf="booking.description || booking.additionalDetails" class="flex items-start">
              <div
                class="w-8 h-8 bg-handy-blue-100 rounded-lg flex items-center justify-center mr-3 mt-0.5 flex-shrink-0"
              >
                <ion-icon
                  name="document-text"
                  class="text-handy-blue-500 text-sm"
                ></ion-icon>
              </div>
              <div class="flex-1">
                <p class="text-xs font-semibold text-handy-navy-600 mb-1">
                  Additional Details
                </p>
                <p class="text-sm text-gray-700 leading-relaxed">
                  {{ booking.additionalDetails || booking.description || 'No additional details provided' }}
                </p>
              </div>
            </div>

            <div class="flex items-start">
              <div
                class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center mr-3 mt-0.5 flex-shrink-0"
              >
                <ion-icon
                  name="construct"
                  class="text-purple-500 text-sm"
                ></ion-icon>
              </div>
              <div class="flex-1">
                <p class="text-xs font-semibold text-handy-navy-600 mb-1">
                  Requested Service
                </p>
                <p class="text-sm text-gray-700 font-medium bg-purple-50 px-3 py-2 rounded-lg border border-purple-100">
                  {{ getServiceName(booking) }}
                </p>
              </div>
            </div>

            <div class="flex items-start">
              <div
                class="w-8 h-8 bg-handy-yellow-100 rounded-lg flex items-center justify-center mr-3 mt-0.5 flex-shrink-0"
              >
                <ion-icon
                  name="calendar"
                  class="text-handy-yellow-600 text-sm"
                ></ion-icon>
              </div>
              <div class="flex-1">
                <p class="text-xs font-semibold text-handy-navy-600 mb-1">
                  Preferred Schedule
                </p>
                <div class="bg-handy-yellow-50 px-3 py-2 rounded-lg border border-handy-yellow-100">
                  <p class="text-sm text-gray-700 font-medium flex items-center">
                    <ion-icon name="calendar-outline" class="mr-1 text-handy-yellow-600"></ion-icon>
                    {{ formatScheduleDate(booking) }}
                  </p>
                  <p class="text-sm text-gray-600 flex items-center mt-1">
                    <ion-icon name="time-outline" class="mr-1 text-handy-yellow-600"></ion-icon>
                    {{ getPreferredTime(booking) }}
                  </p>
                </div>
              </div>
            </div>

            <div
              *ngIf="booking.locations && booking.locations.length > 0"
              class="flex items-start"
            >
              <div
                class="w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center mr-3 mt-0.5 flex-shrink-0"
              >
                <ion-icon
                  name="location"
                  class="text-red-500 text-sm"
                ></ion-icon>
              </div>
              <div class="flex-1">
                <p class="text-xs font-semibold text-handy-navy-600 mb-1">
                  Service Location
                </p>
                <p class="text-sm text-gray-700 leading-relaxed">
                  {{ booking.locations[0].address }}
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- Enhanced Price and Actions Section -->
        <div class="flex flex-col space-y-4">
          <!-- Price Section -->
          <div
            class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-3 border border-green-100"
          >
            <div class="flex items-center justify-center">
              <div class="flex items-center space-x-2">
                <div
                  class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center"
                >
                  <ion-icon
                    name="cash"
                    class="text-green-500 text-sm"
                  ></ion-icon>
                </div>
                <div class="text-center">
                  <p class="text-xs font-semibold text-gray-600 mb-1">
                    Client Budget
                  </p>
                  <div class="flex flex-col items-center space-y-1">
                    <span class="text-lg font-bold text-green-600">
                      ₱{{ getPriceRange(booking).min | number:'1.0-0' }}
                      <span
                        *ngIf="getPriceRange(booking).min !== getPriceRange(booking).max"
                        class="text-sm font-medium"
                      >
                        - ₱{{ getPriceRange(booking).max | number:'1.0-0' }}
                      </span>
                    </span>
                    <span class="text-xs text-gray-500 font-medium">Budget Range</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="flex space-x-3">
            <button
              (click)="acceptBooking(booking.id!)"
              class="flex-1 bg-gradient-to-r from-handy-blue-500 to-handy-blue-600 hover:from-handy-blue-600 hover:to-handy-blue-700 text-white px-4 py-3 rounded-xl shadow-md hover:shadow-lg transform hover:scale-105 transition-all duration-200 flex items-center justify-center space-x-2 font-semibold"
            >
              <ion-icon name="checkmark-circle" class="text-base"></ion-icon>
              <span>Accept Request</span>
            </button>
            <button
              (click)="rejectBooking(booking.id!)"
              class="bg-gradient-to-r from-gray-400 to-gray-500 hover:from-gray-500 hover:to-gray-600 text-white px-4 py-3 rounded-xl shadow-md hover:shadow-lg transform hover:scale-105 transition-all duration-200 flex items-center justify-center space-x-2 font-semibold"
            >
              <ion-icon name="close-circle" class="text-base"></ion-icon>
              <span>Decline</span>
            </button>
          </div>
        </div>

        <!-- Enhanced Status Indicator -->
        <div class="mt-4 pt-4 border-t border-handy-blue-100">
          <div class="flex items-center justify-center">
            <div
              class="flex items-center space-x-2 bg-gradient-to-r from-orange-50 to-yellow-50 px-4 py-2 rounded-full border border-orange-100"
            >
              <div class="relative">
                <div class="w-2 h-2 bg-orange-400 rounded-full"></div>
                <div
                  class="absolute inset-0 w-2 h-2 bg-orange-400 rounded-full animate-ping"
                ></div>
              </div>
              <span class="text-orange-600 font-semibold text-sm"
                >Awaiting Your Response</span
              >
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Enhanced Refresh Hint -->
    <div *ngIf="!loading && bookings.length > 0" class="mt-8 text-center">
      <div
        class="bg-gradient-to-r from-handy-blue-50 to-handy-yellow-50 rounded-xl p-4 border border-handy-blue-100"
      >
        <p
          class="text-xs text-handy-navy-600 font-medium flex items-center justify-center space-x-2"
        >
          <ion-icon
            name="sync"
            class="animate-spin text-handy-blue-500"
          ></ion-icon>
          <span>Updates automatically in real-time</span>
          <ion-icon name="checkmark-circle" class="text-green-500"></ion-icon>
        </p>
        <p class="text-xs text-gray-400 mt-1">
          Stay connected to receive new requests instantly
        </p>
      </div>
    </div>
  </div>
</ion-content>
